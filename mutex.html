<!DOCTYPE html><html lang="zh-CN"><head><meta name="viewport" content="width=device-width"/><title>Mutex实现</title><meta name="robots" content="follow, index"/><meta charSet="UTF-8"/><meta name="keywords" content="Blog, Notion, Tech, Python, Django"/><meta name="description"/><meta property="og:locale" content="zh-CN"/><meta property="og:title" content="Mutex实现"/><meta property="og:description"/><meta property="og:url" content="https://hhmy27.github.io/"/><meta property="og:image" content="https://og-image-craigary.vercel.app/Mutex%E5%AE%9E%E7%8E%B0.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:description"/><meta name="twitter:title" content="Mutex实现"/><meta name="twitter:image" content="https://og-image-craigary.vercel.app/Mutex%E5%AE%9E%E7%8E%B0.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg"/><meta property="article:published_time"/><meta property="article:author" content="hhmy"/><meta name="next-head-count" content="18"/><link rel="preload" href="/fonts/IBMPlexSansVar-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/fonts/IBMPlexSansVar-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="preload" as="style" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/><noscript><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/></noscript><link rel="icon" href="/favicon.svg" type="image/svg+xml"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="192x192" href="/apple-touch-icon.png"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/feed"/><meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)"/><meta name="theme-color" content="#18181B" media="(prefers-color-scheme: dark)"/><link rel="preload" href="/_next/static/css/8e8bd7c50b2739f5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e8bd7c50b2739f5.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6a5815369e10547f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6a5815369e10547f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-c0a56147c8fcef8f.js" defer=""></script><script src="/_next/static/chunks/main-e557dee8cfeafd6c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1f665f4c23336632.js" defer=""></script><script src="/_next/static/chunks/b5f2ed29-08db60af0c3043ba.js" defer=""></script><script src="/_next/static/chunks/684-63c1a25e215d8bed.js" defer=""></script><script src="/_next/static/chunks/580-c0214944b9e37cce.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-03011df04807c853.js" defer=""></script><script src="/_next/static/gbspoaI5Kfubj7D-lJTwS/_buildManifest.js" defer=""></script><script src="/_next/static/gbspoaI5Kfubj7D-lJTwS/_ssgManifest.js" defer=""></script><script src="/_next/static/gbspoaI5Kfubj7D-lJTwS/_middlewareManifest.js" defer=""></script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"/></head><body class="bg-day dark:bg-night"><div id="__next" data-reactroot=""><div><div class="wrapper font-sans"><div class="observer-element h-4 md:h-12"></div><div class="sticky-nav m-auto w-full h-6 flex flex-row justify-between items-center mb-2 md:mb-12 py-8 bg-opacity-60 max-w-3xl px-4" id="sticky-nav"><div class="flex items-center"><a aria-label="hhmy 的博客" href="/"><div class="h-6"><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="14" cy="14" r="14" class="fill-current text-black dark:text-white"></circle><circle cx="14" cy="14" r="14" fill="url(#paint0_radial)"></circle><circle cx="8" cy="8" r="1.5" fill="white"></circle><defs><radialGradient id="paint0_radial" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="rotate(45) scale(39.598)"><stop stop-color="#3399FF" stop-opacity="0.9"></stop><stop offset="1" stop-color="#FF3399" stop-opacity="0.6"></stop></radialGradient></defs></svg></div></a><p class="ml-2 font-medium text-day dark:text-night header-name">Mutex实现</p></div><div class="flex-shrink-0"><ul class="flex flex-row"><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/about">关于</a></li><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/search">搜索</a></li></ul></div></div><main class="m-auto flex-grow w-full transition-all max-w-3xl px-4"><article><h1 class="font-bold text-3xl text-black dark:text-white"> <!-- -->Mutex实现</h1><nav class="flex mt-7 items-start text-gray-500 dark:text-gray-400"><div class="flex mb-4"><a href="https://github.com/hhmy27" class="flex"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2724%27%20height=%2724%27/%3e"/></span><img alt="hhmy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="hhmy" srcSet="https://gravatar.com/avatar/c8089598dc27a7944c95a8ed30867b78?imwidth=32 1x, https://gravatar.com/avatar/c8089598dc27a7944c95a8ed30867b78?imwidth=48 2x" src="https://gravatar.com/avatar/c8089598dc27a7944c95a8ed30867b78?imwidth=48" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full" loading="lazy"/></noscript></span><p class="ml-2 md:block">hhmy</p></a><span class="block"> / </span></div><div class="mr-2 mb-4 md:ml-0">2022 年 11 月 22 日</div><div class="flex flex-nowrap max-w-full overflow-x-auto article-tags"><a href="/tag/Go"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">Go</p></a></div></nav><div class="-mt-4"><main class="notion light-mode notion-page notion-block-e7f7db5d3e804afba4a84863c5302031"><div class="notion-viewport"></div><div class="notion-collection-row"><div class="notion-collection-row-body"><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M10.889 5.5H3.11v1.556h7.778V5.5zm1.555-4.444h-.777V0H10.11v1.056H3.89V0H2.333v1.056h-.777c-.864 0-1.548.7-1.548 1.555L0 12.5c0 .856.692 1.5 1.556 1.5h10.888C13.3 14 14 13.356 14 12.5V2.611c0-.855-.7-1.555-1.556-1.555zm0 11.444H1.556V3.944h10.888V12.5zM8.556 8.611H3.11v1.556h5.445V8.61z"></path></svg><div class="notion-collection-column-title-body">date</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-date">Nov 22, 2022</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">slug</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text">mutex</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">status</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"><div class="notion-property-select-item notion-item-red">Published</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M4 3a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zM2 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2z"></path></svg><div class="notion-collection-column-title-body">tags</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-multi_select"><div class="notion-property-multi_select-item notion-item-default">Go</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">summary</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text"></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">type</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"><div class="notion-property-select-item notion-item-purple">Post</div></span></div></div></div></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-04c905526f5847d698f2d2cb225568f5" data-id="04c905526f5847d698f2d2cb225568f5"><span><div id="04c905526f5847d698f2d2cb225568f5" class="notion-header-anchor"></div><a class="notion-hash-link" href="#04c905526f5847d698f2d2cb225568f5" title="初代mutex"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">初代mutex</span></span></h2><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-c7c47b041c694ac2979cf12c9735d48a"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Fs3.us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F1d57b8cd-39e8-491f-98d8-b58d4d173842%2FUntitled.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DAKIAT73L2G45EIPT3X45%252F20221216%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20221216T105818Z%26X-Amz-Expires%3D86400%26X-Amz-Signature%3D9c9f86bb19524627622c39bc82193f2c57ed0b8151c0f534f2e2d3fe9aef6b4f%26X-Amz-SignedHeaders%3Dhost%26x-id%3DGetObject?table=block&amp;id=c7c47b04-1c69-4ac2-979c-f12c9735d48a&amp;cache=v2" loading="lazy" alt="notion image" decoding="async"/></div></figure><div class="notion-text notion-block-eb6d7a9b0bf24e45b9553103990728be">特点：</div><ul class="notion-list notion-list-disc notion-block-8df29c2fee32404cbb9b9db5333c3de4"><li>只有key和sema两个变量，利用CAS从左值</li></ul><ul class="notion-list notion-list-disc notion-block-2e232adefe2d4b2aba7f7726820e303b"><li>key：表示持有锁和等待锁的数量</li></ul><ul class="notion-list notion-list-disc notion-block-da9995aeffe6443195a2dda6b2b36b36"><li>sema：等待者队列使用的信号量</li></ul><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-93767f90a23c428aad6bc2e7e1fb89ca"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Fs3.us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F089431dc-95ae-47ea-a360-feb9284f2379%2FUntitled.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DAKIAT73L2G45EIPT3X45%252F20221216%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20221216T105818Z%26X-Amz-Expires%3D86400%26X-Amz-Signature%3D85de06bc886b15590bf6e219e8d96e18483f98dfcb6cc2865071bbba8fc0cceb%26X-Amz-SignedHeaders%3Dhost%26x-id%3DGetObject?table=block&amp;id=93767f90-a23c-428a-ad6b-c2e7e1fb89ca&amp;cache=v2" loading="lazy" alt="notion image" decoding="async"/></div></figure><div class="notion-text notion-block-f0c9fa92ac46476eaf7ece2e0393f610">逻辑还是一样的：</div><ul class="notion-list notion-list-disc notion-block-2479f8de639744d7a6beda58b7363231"><li>Lock，尝试加锁，使用cas对key操作，如果结果为1，表示持有成功，否则阻塞等待sema</li></ul><ul class="notion-list notion-list-disc notion-block-87770a7c56d0418da3706811c54c91cd"><li>Unlock，解锁，对key操作，如果为0，则没有等待者可以直接返回，否则唤醒sema的等待者</li></ul><div class="notion-text notion-block-b384572855cf4441b18d74e59f498bbf">注意：</div><ul class="notion-list notion-list-disc notion-block-3a229490f59e41f288232ac29581feec"><li>Unlock没有对调用者做检查，不是锁的持有者也可以释放锁。因此我们一般使用defer来进行优化调用</li><ul class="notion-list notion-list-disc notion-block-3a229490f59e41f288232ac29581feec"><pre class="notion-code language-go"><code class="language-go">mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
defer mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></ul></ul><div class="notion-blank notion-block-56c98aac4c9a46e2bce8a2847092248a"> </div><div class="notion-text notion-block-3b098aa79076440396a73e904d6a0a41">这个版本的实现遗留了一个问题，请求锁的goroutine会排队等待获取互斥锁，也就是公平锁，我们先实现一个非公平锁，让正在占用CPU时间片的goroutine先获取到锁，这样能够避免做上下文的切换</div><div class="notion-blank notion-block-ded130c1c43c43dc87dd39a94ee16fbe"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-290a37c1e6a04c20afea447a9c34f362" data-id="290a37c1e6a04c20afea447a9c34f362"><span><div id="290a37c1e6a04c20afea447a9c34f362" class="notion-header-anchor"></div><a class="notion-hash-link" href="#290a37c1e6a04c20afea447a9c34f362" title="非公平锁"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">非公平锁</span></span></h2><div class="notion-text notion-block-229a5945de6748d8a6310b0d8a013d52">做了一次调整</div><pre class="notion-code language-go"><code class="language-go">type Mutex struct <span class="token punctuation">{</span>
        state int32
        sema  uint32
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token punctuation">(</span>
        mutexLocked <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> iota <span class="token comment">// mutex is locked</span>
        mutexWoken
        mutexWaiterShift <span class="token operator">=</span> iota
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-f04df2739e7746c983ed0031299f88d0"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Fs3.us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9c456516-c885-4335-8d79-cd694989abf7%2FUntitled.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DAKIAT73L2G45EIPT3X45%252F20221216%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20221216T105818Z%26X-Amz-Expires%3D86400%26X-Amz-Signature%3De9527dfc3ad7845f1a7ef60a2ad9118151b12fd7d050004e3d5a1b54753afd80%26X-Amz-SignedHeaders%3Dhost%26x-id%3DGetObject?table=block&amp;id=f04df273-9e77-46c9-83ed-0031299f88d0&amp;cache=v2" loading="lazy" alt="notion image" decoding="async"/></div></figure><div class="notion-text notion-block-d589b2f1563a4409a9bfdfb6fdb8e5aa">这里state是一个复合型的字段，包含了多个信息，和java线程池表示状态的实现很类似</div><ul class="notion-list notion-list-disc notion-block-ca214425388a409a9eb86b40983d47a0"><li>第一位（低位）表示锁是否被持有</li></ul><ul class="notion-list notion-list-disc notion-block-6eb0a24601ef437189ff700ad293c899"><li>第二位表示是否有唤醒的goroutine</li></ul><ul class="notion-list notion-list-disc notion-block-73219887125148a2ba940b897cdd1bbd"><li>第三位表示等待此锁的goroutine</li></ul><div class="notion-text notion-block-03dc36a09e254ad79810fcaf73ed0028">加锁方法变复杂了</div><pre class="notion-code language-go"><code class="language-go"><span class="token function">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Mutex<span class="token punctuation">)</span> <span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Fast path: 幸运case，能够直接获取到锁</span>
        <span class="token keyword">if</span> atomic<span class="token punctuation">.</span><span class="token function">CompareAndSwapInt32</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">&amp;</span>m<span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mutexLocked</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token literal-property property">awoke</span> <span class="token operator">:</span><span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">for</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">old</span> <span class="token operator">:</span><span class="token operator">=</span> m<span class="token punctuation">.</span>state
            <span class="token keyword">new</span> <span class="token operator">:</span><span class="token operator">=</span> old <span class="token operator">|</span> mutexLocked <span class="token comment">// 新状态加锁</span>
            <span class="token keyword">if</span> old<span class="token operator">&amp;</span>mutexLocked <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
                <span class="token keyword">new</span> <span class="token operator">=</span> old <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">&lt;&lt;</span>mutexWaiterShift <span class="token comment">//等待者数量加一</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> awoke <span class="token punctuation">{</span>
                <span class="token comment">// goroutine是被唤醒的，</span>
                <span class="token comment">// 新状态清除唤醒标志</span>
                <span class="token keyword">new</span> <span class="token operator">&amp;</span><span class="token operator">^=</span> mutexWoken
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> atomic<span class="token punctuation">.</span><span class="token function">CompareAndSwapInt32</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">&amp;</span>m<span class="token punctuation">.</span>state<span class="token punctuation">,</span> old<span class="token punctuation">,</span> <span class="token keyword">new</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//设置新状态</span>
                <span class="token keyword">if</span> old<span class="token operator">&amp;</span>mutexLocked <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span> <span class="token comment">// 锁原状态未加锁</span>
                    <span class="token keyword">break</span>
                <span class="token punctuation">}</span>
                runtime<span class="token punctuation">.</span><span class="token function">Semacquire</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">.</span>sema<span class="token punctuation">)</span> <span class="token comment">// 请求信号量</span>
                awoke <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-613f5493053a42ffb024acdfae5b3d15" data-id="613f5493053a42ffb024acdfae5b3d15"><span><div id="613f5493053a42ffb024acdfae5b3d15" class="notion-header-anchor"></div><a class="notion-hash-link" href="#613f5493053a42ffb024acdfae5b3d15" title="自旋版本"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">自旋版本</span></span></h2><div class="notion-blank notion-block-6d730068ae51489aa1ef6fcc32d49f59"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-03fb9424a57846039fdb1bdc86b9d178" data-id="03fb9424a57846039fdb1bdc86b9d178"><span><div id="03fb9424a57846039fdb1bdc86b9d178" class="notion-header-anchor"></div><a class="notion-hash-link" href="#03fb9424a57846039fdb1bdc86b9d178" title="解决饥饿"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">解决饥饿</span></span></h2><div class="notion-blank notion-block-4c0b510234b44b3087ec05579db1da07"> </div></main></div></article><div class="flex justify-between font-medium text-gray-500 dark:text-gray-400"><a><button class="mt-2 cursor-pointer hover:text-black dark:hover:text-gray-100">← <!-- -->返回</button></a><a><button class="mt-2 cursor-pointer hover:text-black dark:hover:text-gray-100">↑ <!-- -->回到顶部</button></a></div><div></div></main><div class="mt-6 flex-shrink-0 m-auto w-full text-gray-500 dark:text-gray-400 transition-all max-w-3xl px-4"><hr class="border-gray-200 dark:border-gray-600"/><div class="my-4 text-sm leading-6"><div class="flex align-baseline justify-between flex-wrap"><p>© <!-- -->hhmy<!-- --> <!-- -->2019 - 2022</p><p>powered by <a href="https://github.com/craigary/nobelium"><u>nobelium</u></a></p></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","date":{"start_date":"2022-11-22"},"type":["Post"],"slug":"mutex","tags":["Go"],"title":"Mutex实现","status":["Published"],"createdTime":"Fri Dec 16 2022 08:30:47 GMT+0000 (Coordinated Universal Time)","fullWidth":false,"pageIcon":null,"pageCover":null},"blockMap":{"block":{"e7f7db5d-3e80-4afb-a4a8-4863c5302031":{"role":"reader","value":{"id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","version":22,"type":"page","properties":{"!`\"w":[["No"]],"98uZ":[["Mutex是一种同步原语（Synchronization primitives）"]],":H`m":[["No"]],"NX\\Q":[["‣",[["d",{"type":"date","start_date":"2022-11-22"}]]]],"`gQ~":[["Post"]],"d]hq":[["mutex"]],"sD^m":[["Go"]],"xY$N":[["‣",[["d",{"type":"date","start_date":"2022-11-22"}]]]],"{iD?":[["Go"]],"|Ay0":[[""]],"title":[["Mutex实现"]],"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":[["Published"]]},"content":["04c90552-6f58-47d6-98f2-d2cb225568f5","c7c47b04-1c69-4ac2-979c-f12c9735d48a","eb6d7a9b-0bf2-4e45-b955-3103990728be","8df29c2f-ee32-404c-bb9b-9db5333c3de4","2e232ade-fe2d-4b2a-ba7f-7726820e303b","da9995ae-ffe6-4431-95a2-dda6b2b36b36","93767f90-a23c-428a-ad6b-c2e7e1fb89ca","f0c9fa92-ac46-476e-af7e-ce2e0393f610","2479f8de-6397-44d7-a6be-da58b7363231","87770a7c-56d0-418d-a370-6811c54c91cd","b3845728-55cf-4441-b18d-74e59f498bbf","3a229490-f59e-41f2-8823-2ac29581feec","56c98aac-4c9a-46e2-bce8-a2847092248a","3b098aa7-9076-4403-96a7-3e904d6a0a41","ded130c1-c43c-43dc-87dd-39a94ee16fbe","290a37c1-e6a0-4c20-afea-447a9c34f362","229a5945-de67-48d8-a631-0b0d8a013d52","1c368b57-346f-4a92-94d5-8ceb2043f2be","f04df273-9e77-46c9-83ed-0031299f88d0","d589b2f1-563a-4409-a9bf-dfb6fdb8e5aa","ca214425-388a-409a-9eb8-6b40983d47a0","6eb0a246-01ef-4371-89ff-700ad293c899","73219887-1251-48a2-ba94-0b897cdd1bbd","03dc36a0-9e25-4ad7-9810-fcaf73ed0028","89b20a34-10a0-452f-806b-4c82359b7ae5","613f5493-053a-42ff-b024-acdfae5b3d15","6d730068-ae51-489a-a1ef-6fcc32d49f59","03fb9424-a578-4603-9fdb-1bdc86b9d178","4c0b5102-34b4-4b30-87ec-05579db1da07"],"format":{"copied_from_pointer":{"id":"78c2b21e-a705-461f-af89-71f391251fb5","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447468,"last_edited_time":1671187800000,"parent_id":"a3ce75fe-7085-406b-a33f-74958ef7ee13","parent_table":"collection","alive":true,"copied_from":"78c2b21e-a705-461f-af89-71f391251fb5","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"1d21f050-c8c4-41f3-9fd4-8ff7de49c962":{"role":"reader","value":{"id":"1d21f050-c8c4-41f3-9fd4-8ff7de49c962","version":46,"type":"collection_view_page","view_ids":["876cf270-3f6b-4f1a-b6c8-5ffbd27ca40f"],"collection_id":"a3ce75fe-7085-406b-a33f-74958ef7ee13","format":{"block_locked":false,"block_locked_by":"2c0e0b01-f59e-4e03-b7b6-7d706eecada3","collection_pointer":{"id":"a3ce75fe-7085-406b-a33f-74958ef7ee13","table":"collection","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"copied_from_pointer":{"id":"866916e3-b939-468b-9b6f-1d47dce99f9c","table":"block","spaceId":"ac4cb96d-c8f8-4040-9bb2-868d9fc7f526"}},"permissions":[{"role":"editor","type":"user_permission","user_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec"},{"role":"reader","type":"public_permission","added_timestamp":1671187403441}],"created_time":1670483100421,"last_edited_time":1671187380000,"parent_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4","parent_table":"space","alive":true,"copied_from":"866916e3-b939-468b-9b6f-1d47dce99f9c","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"04c90552-6f58-47d6-98f2-d2cb225568f5":{"role":"reader","value":{"id":"04c90552-6f58-47d6-98f2-d2cb225568f5","version":1,"type":"header","properties":{"title":[["初代mutex"]]},"format":{"copied_from_pointer":{"id":"c751b507-443b-43e7-a62c-b3a8977b6218","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"c751b507-443b-43e7-a62c-b3a8977b6218","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"c7c47b04-1c69-4ac2-979c-f12c9735d48a":{"role":"reader","value":{"id":"c7c47b04-1c69-4ac2-979c-f12c9735d48a","version":1,"type":"image","properties":{"size":[["188.8KB"]],"title":[["Untitled"]],"source":[["https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1d57b8cd-39e8-491f-98d8-b58d4d173842/Untitled.png"]]},"format":{"block_width":1150,"display_source":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1d57b8cd-39e8-491f-98d8-b58d4d173842/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":1.2469565217391305,"copied_from_pointer":{"id":"416dc178-7d4e-48e4-bab3-2e568a55c265","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"block_preserve_scale":true},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"416dc178-7d4e-48e4-bab3-2e568a55c265","file_ids":["1d57b8cd-39e8-491f-98d8-b58d4d173842"],"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"eb6d7a9b-0bf2-4e45-b955-3103990728be":{"role":"reader","value":{"id":"eb6d7a9b-0bf2-4e45-b955-3103990728be","version":1,"type":"text","properties":{"title":[["特点："]]},"format":{"copied_from_pointer":{"id":"67eef21b-5900-4501-b171-95a30811c347","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"67eef21b-5900-4501-b171-95a30811c347","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"8df29c2f-ee32-404c-bb9b-9db5333c3de4":{"role":"reader","value":{"id":"8df29c2f-ee32-404c-bb9b-9db5333c3de4","version":1,"type":"bulleted_list","properties":{"title":[["只有key和sema两个变量，利用CAS从左值"]]},"format":{"copied_from_pointer":{"id":"70ea1e15-39eb-4052-8c68-d8c62b4c5bca","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"70ea1e15-39eb-4052-8c68-d8c62b4c5bca","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"2e232ade-fe2d-4b2a-ba7f-7726820e303b":{"role":"reader","value":{"id":"2e232ade-fe2d-4b2a-ba7f-7726820e303b","version":1,"type":"bulleted_list","properties":{"title":[["key：表示持有锁和等待锁的数量"]]},"format":{"copied_from_pointer":{"id":"7b957520-5f5a-4c55-92be-3dc30330de56","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"7b957520-5f5a-4c55-92be-3dc30330de56","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"da9995ae-ffe6-4431-95a2-dda6b2b36b36":{"role":"reader","value":{"id":"da9995ae-ffe6-4431-95a2-dda6b2b36b36","version":1,"type":"bulleted_list","properties":{"title":[["sema：等待者队列使用的信号量"]]},"format":{"copied_from_pointer":{"id":"f7fcf2ec-c687-4d8f-8811-b92d078f5f85","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"f7fcf2ec-c687-4d8f-8811-b92d078f5f85","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"93767f90-a23c-428a-ad6b-c2e7e1fb89ca":{"role":"reader","value":{"id":"93767f90-a23c-428a-ad6b-c2e7e1fb89ca","version":1,"type":"image","properties":{"size":[["526.0KB"]],"title":[["Untitled"]],"source":[["https://s3-us-west-2.amazonaws.com/secure.notion-static.com/089431dc-95ae-47ea-a360-feb9284f2379/Untitled.png"]]},"format":{"block_width":3032,"display_source":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/089431dc-95ae-47ea-a360-feb9284f2379/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.725263852242744,"copied_from_pointer":{"id":"e469eb47-acbd-4ff6-8cfb-fca78d2d8464","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"block_preserve_scale":true},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"e469eb47-acbd-4ff6-8cfb-fca78d2d8464","file_ids":["089431dc-95ae-47ea-a360-feb9284f2379"],"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"f0c9fa92-ac46-476e-af7e-ce2e0393f610":{"role":"reader","value":{"id":"f0c9fa92-ac46-476e-af7e-ce2e0393f610","version":1,"type":"text","properties":{"title":[["逻辑还是一样的："]]},"format":{"copied_from_pointer":{"id":"1acaba04-4a6a-4b8b-a52b-370a7e2954cc","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"1acaba04-4a6a-4b8b-a52b-370a7e2954cc","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"2479f8de-6397-44d7-a6be-da58b7363231":{"role":"reader","value":{"id":"2479f8de-6397-44d7-a6be-da58b7363231","version":1,"type":"bulleted_list","properties":{"title":[["Lock，尝试加锁，使用cas对key操作，如果结果为1，表示持有成功，否则阻塞等待sema"]]},"format":{"copied_from_pointer":{"id":"8a6b8408-be75-41b7-abe2-9ef2b77155c2","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"8a6b8408-be75-41b7-abe2-9ef2b77155c2","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"87770a7c-56d0-418d-a370-6811c54c91cd":{"role":"reader","value":{"id":"87770a7c-56d0-418d-a370-6811c54c91cd","version":1,"type":"bulleted_list","properties":{"title":[["Unlock，解锁，对key操作，如果为0，则没有等待者可以直接返回，否则唤醒sema的等待者"]]},"format":{"copied_from_pointer":{"id":"52354f41-9771-4e17-a9aa-f31e4a7b916c","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"52354f41-9771-4e17-a9aa-f31e4a7b916c","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"b3845728-55cf-4441-b18d-74e59f498bbf":{"role":"reader","value":{"id":"b3845728-55cf-4441-b18d-74e59f498bbf","version":1,"type":"text","properties":{"title":[["注意："]]},"format":{"copied_from_pointer":{"id":"181bd007-c8a9-41ee-9bf3-0692e2f10e32","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"181bd007-c8a9-41ee-9bf3-0692e2f10e32","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"3a229490-f59e-41f2-8823-2ac29581feec":{"role":"reader","value":{"id":"3a229490-f59e-41f2-8823-2ac29581feec","version":1,"type":"bulleted_list","properties":{"title":[["Unlock没有对调用者做检查，不是锁的持有者也可以释放锁。因此我们一般使用defer来进行优化调用"]]},"content":["b780047b-0900-4acc-a034-37575ea1d7bc"],"format":{"copied_from_pointer":{"id":"aedbd3a0-524c-4590-97c1-49d47e489f90","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"aedbd3a0-524c-4590-97c1-49d47e489f90","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"b780047b-0900-4acc-a034-37575ea1d7bc":{"role":"reader","value":{"id":"b780047b-0900-4acc-a034-37575ea1d7bc","version":1,"type":"code","properties":{"title":[["mu.Lock()\ndefer mu.Unlock()"]],"language":[["Go"]]},"format":{"copied_from_pointer":{"id":"ac6728b8-e5b2-49fd-8bcc-8f1bfc953565","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"3a229490-f59e-41f2-8823-2ac29581feec","parent_table":"block","alive":true,"copied_from":"ac6728b8-e5b2-49fd-8bcc-8f1bfc953565","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"56c98aac-4c9a-46e2-bce8-a2847092248a":{"role":"reader","value":{"id":"56c98aac-4c9a-46e2-bce8-a2847092248a","version":1,"type":"text","format":{"copied_from_pointer":{"id":"a48986ca-e88d-45cb-9aba-46992336b4ea","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"a48986ca-e88d-45cb-9aba-46992336b4ea","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"3b098aa7-9076-4403-96a7-3e904d6a0a41":{"role":"reader","value":{"id":"3b098aa7-9076-4403-96a7-3e904d6a0a41","version":1,"type":"text","properties":{"title":[["这个版本的实现遗留了一个问题，请求锁的goroutine会排队等待获取互斥锁，也就是公平锁，我们先实现一个非公平锁，让正在占用CPU时间片的goroutine先获取到锁，这样能够避免做上下文的切换"]]},"format":{"copied_from_pointer":{"id":"10515ecd-b0a3-4129-9e4c-42c3b6830fd8","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"10515ecd-b0a3-4129-9e4c-42c3b6830fd8","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"ded130c1-c43c-43dc-87dd-39a94ee16fbe":{"role":"reader","value":{"id":"ded130c1-c43c-43dc-87dd-39a94ee16fbe","version":1,"type":"text","format":{"copied_from_pointer":{"id":"33da82ac-504a-429b-95ce-024596856ca8","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"33da82ac-504a-429b-95ce-024596856ca8","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"290a37c1-e6a0-4c20-afea-447a9c34f362":{"role":"reader","value":{"id":"290a37c1-e6a0-4c20-afea-447a9c34f362","version":1,"type":"header","properties":{"title":[["非公平锁"]]},"format":{"copied_from_pointer":{"id":"9b29ea2f-bfcf-4d52-b1b1-5188e6e65216","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"9b29ea2f-bfcf-4d52-b1b1-5188e6e65216","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"229a5945-de67-48d8-a631-0b0d8a013d52":{"role":"reader","value":{"id":"229a5945-de67-48d8-a631-0b0d8a013d52","version":1,"type":"text","properties":{"title":[["做了一次调整"]]},"format":{"copied_from_pointer":{"id":"f4d8c419-ae01-4d54-b31e-d801606e495d","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"f4d8c419-ae01-4d54-b31e-d801606e495d","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"1c368b57-346f-4a92-94d5-8ceb2043f2be":{"role":"reader","value":{"id":"1c368b57-346f-4a92-94d5-8ceb2043f2be","version":1,"type":"code","properties":{"title":[["type Mutex struct {\n        state int32\n        sema  uint32\n    }\n\n    const (\n        mutexLocked = 1 \u003c\u003c iota // mutex is locked\n        mutexWoken\n        mutexWaiterShift = iota\n    )\n}"]],"language":[["Go"]]},"format":{"copied_from_pointer":{"id":"00f2d00f-ca11-42b5-9acc-94cde9f4e09c","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447466,"last_edited_time":1671179447466,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"00f2d00f-ca11-42b5-9acc-94cde9f4e09c","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"f04df273-9e77-46c9-83ed-0031299f88d0":{"role":"reader","value":{"id":"f04df273-9e77-46c9-83ed-0031299f88d0","version":1,"type":"image","properties":{"size":[["407.3KB"]],"title":[["Untitled"]],"source":[["https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9c456516-c885-4335-8d79-cd694989abf7/Untitled.png"]]},"format":{"block_width":2978,"display_source":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9c456516-c885-4335-8d79-cd694989abf7/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.5896574882471457,"copied_from_pointer":{"id":"27d9e191-3f54-4e16-98f5-8945b5a43ed3","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"block_preserve_scale":true},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"27d9e191-3f54-4e16-98f5-8945b5a43ed3","file_ids":["9c456516-c885-4335-8d79-cd694989abf7"],"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"d589b2f1-563a-4409-a9bf-dfb6fdb8e5aa":{"role":"reader","value":{"id":"d589b2f1-563a-4409-a9bf-dfb6fdb8e5aa","version":1,"type":"text","properties":{"title":[["这里state是一个复合型的字段，包含了多个信息，和java线程池表示状态的实现很类似"]]},"format":{"copied_from_pointer":{"id":"eea8ef9d-abec-46f5-a515-a5e5bde50eee","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"eea8ef9d-abec-46f5-a515-a5e5bde50eee","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"ca214425-388a-409a-9eb8-6b40983d47a0":{"role":"reader","value":{"id":"ca214425-388a-409a-9eb8-6b40983d47a0","version":1,"type":"bulleted_list","properties":{"title":[["第一位（低位）表示锁是否被持有"]]},"format":{"copied_from_pointer":{"id":"5f0b8a20-7b91-443e-bb0b-db80abc9f51d","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"5f0b8a20-7b91-443e-bb0b-db80abc9f51d","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"6eb0a246-01ef-4371-89ff-700ad293c899":{"role":"reader","value":{"id":"6eb0a246-01ef-4371-89ff-700ad293c899","version":1,"type":"bulleted_list","properties":{"title":[["第二位表示是否有唤醒的goroutine"]]},"format":{"copied_from_pointer":{"id":"f6ab9c7d-f706-48d2-8da3-3ef63894387b","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"f6ab9c7d-f706-48d2-8da3-3ef63894387b","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"73219887-1251-48a2-ba94-0b897cdd1bbd":{"role":"reader","value":{"id":"73219887-1251-48a2-ba94-0b897cdd1bbd","version":1,"type":"bulleted_list","properties":{"title":[["第三位表示等待此锁的goroutine"]]},"format":{"copied_from_pointer":{"id":"4f47c215-c55a-43b3-8710-57df0fd7ea2b","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"4f47c215-c55a-43b3-8710-57df0fd7ea2b","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"03dc36a0-9e25-4ad7-9810-fcaf73ed0028":{"role":"reader","value":{"id":"03dc36a0-9e25-4ad7-9810-fcaf73ed0028","version":1,"type":"text","properties":{"title":[["加锁方法变复杂了"]]},"format":{"copied_from_pointer":{"id":"b8dbcfff-e8d8-4e21-8fbe-612c63a7dd3e","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"b8dbcfff-e8d8-4e21-8fbe-612c63a7dd3e","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"89b20a34-10a0-452f-806b-4c82359b7ae5":{"role":"reader","value":{"id":"89b20a34-10a0-452f-806b-4c82359b7ae5","version":1,"type":"code","properties":{"title":[["func (m *Mutex) Lock() {\n        // Fast path: 幸运case，能够直接获取到锁\n        if atomic.CompareAndSwapInt32(\u0026m.state, 0, mutexLocked) {\n            return\n        }\n        awoke := false\n        for {\n            old := m.state\n            new := old | mutexLocked // 新状态加锁\n            if old\u0026mutexLocked != 0 {\n                new = old + 1\u003c\u003cmutexWaiterShift //等待者数量加一\n            }\n            if awoke {\n                // goroutine是被唤醒的，\n                // 新状态清除唤醒标志\n                new \u0026^= mutexWoken\n            }\n            if atomic.CompareAndSwapInt32(\u0026m.state, old, new) {//设置新状态\n                if old\u0026mutexLocked == 0 { // 锁原状态未加锁\n                    break\n                }\n                runtime.Semacquire(\u0026m.sema) // 请求信号量\n                awoke = true\n            }\n        }\n    }"]],"language":[["Go"]]},"format":{"copied_from_pointer":{"id":"9535790d-43bb-49db-805d-7522b20b080f","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"9535790d-43bb-49db-805d-7522b20b080f","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"613f5493-053a-42ff-b024-acdfae5b3d15":{"role":"reader","value":{"id":"613f5493-053a-42ff-b024-acdfae5b3d15","version":1,"type":"header","properties":{"title":[["自旋版本"]]},"format":{"copied_from_pointer":{"id":"95253ce7-eedd-4f98-ac41-c9bd385c18ce","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"95253ce7-eedd-4f98-ac41-c9bd385c18ce","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"6d730068-ae51-489a-a1ef-6fcc32d49f59":{"role":"reader","value":{"id":"6d730068-ae51-489a-a1ef-6fcc32d49f59","version":1,"type":"text","format":{"copied_from_pointer":{"id":"5362edfe-d3c8-4e15-a916-a404fb7c6c29","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"5362edfe-d3c8-4e15-a916-a404fb7c6c29","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"03fb9424-a578-4603-9fdb-1bdc86b9d178":{"role":"reader","value":{"id":"03fb9424-a578-4603-9fdb-1bdc86b9d178","version":1,"type":"header","properties":{"title":[["解决饥饿"]]},"format":{"copied_from_pointer":{"id":"8561df61-11aa-434d-9167-1fe47f0d9cd8","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"8561df61-11aa-434d-9167-1fe47f0d9cd8","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"4c0b5102-34b4-4b30-87ec-05579db1da07":{"role":"reader","value":{"id":"4c0b5102-34b4-4b30-87ec-05579db1da07","version":1,"type":"text","format":{"copied_from_pointer":{"id":"01fa0cbe-4fc9-4331-bb44-09001e0ca3a0","table":"block","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}},"created_time":1671179447467,"last_edited_time":1671179447467,"parent_id":"e7f7db5d-3e80-4afb-a4a8-4863c5302031","parent_table":"block","alive":true,"copied_from":"01fa0cbe-4fc9-4331-bb44-09001e0ca3a0","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}}},"collection":{"a3ce75fe-7085-406b-a33f-74958ef7ee13":{"role":"reader","value":{"id":"a3ce75fe-7085-406b-a33f-74958ef7ee13","version":18,"name":[["NOBELIUM Template"]],"schema":{"NX\\Q":{"name":"date","type":"date"},"`gQ~":{"name":"type","type":"select","options":[{"id":"5aff2f95-fd1e-489b-8840-bf10bc9519cb","color":"purple","value":"Post"},{"id":"374d2bc6-a144-4832-8ca4-474aaae0ea1f","color":"orange","value":"Page"}]},"d]hq":{"name":"slug","type":"text"},"sD^m":{"name":"tags","type":"multi_select","options":[{"id":"149b2bfe-eff9-4a8e-a509-740376958f01","color":"orange","value":"计算机网络"},{"id":"fbfb28ff-2898-4f5b-a8e9-f18499a0f3da","color":"default","value":"Go"},{"id":"a7a581b6-5d07-466e-b0c8-69b6752bf06e","color":"gray","value":"数据库"},{"id":"7352dc92-14af-4c61-a6e4-1abfed244c4c","color":"purple","value":"算法"}]},"wz|S":{"name":"summary","type":"text"},"title":{"name":"title","type":"title"},"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":{"name":"status","type":"select","options":[{"id":"22460321-fea2-4c7c-b352-a674760780ac","color":"orange","value":"Idea"},{"id":"41d5f5c6-b53c-42bc-8e0f-fc9402048480","color":"yellow","value":"Draft"},{"id":"c7390b31-9fab-4e21-94ee-7e67ea077a97","color":"blue","value":"Revise"},{"id":"7abc61d4-b405-480d-b699-12588755fa65","color":"red","value":"Published"}]}},"icon":"🎟️","format":{"copied_from_pointer":{"id":"dbf0f671-8075-49b9-b238-61e7eb9a7270","table":"collection","spaceId":"ac4cb96d-c8f8-4040-9bb2-868d9fc7f526"},"collection_page_properties":[{"visible":false,"property":"NX\\Q"},{"visible":false,"property":"d]hq"},{"visible":false,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"visible":false,"property":"sD^m"},{"visible":false,"property":"wz|S"},{"visible":false,"property":"`gQ~"}]},"parent_id":"1d21f050-c8c4-41f3-9fd4-8ff7de49c962","parent_table":"block","alive":true,"file_ids":["6cf3dc36-2f98-4f0e-9679-1bdbb1485129","5520bd92-e709-4c0d-ad58-06923f23f7e9","624d393a-62e3-4464-a1bf-1c79ecd4fbda","d52f6766-3e32-4c3d-8529-46e1f214360f"],"copied_from":"dbf0f671-8075-49b9-b238-61e7eb9a7270","migrated":true,"space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}}},"space":{},"collection_view":{"876cf270-3f6b-4f1a-b6c8-5ffbd27ca40f":{"role":"reader","value":{"id":"876cf270-3f6b-4f1a-b6c8-5ffbd27ca40f","version":20,"type":"table","name":"Default view","format":{"table_wrap":false,"table_properties":[{"width":416,"visible":true,"property":"title"},{"width":186,"visible":true,"property":"d]hq"},{"width":211,"visible":true,"property":"NX\\Q"},{"width":147,"visible":true,"property":"wz|S"},{"width":222,"visible":true,"property":"sD^m"},{"width":124,"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"width":100,"visible":true,"property":"`gQ~"},{"width":200,"visible":true,"property":"gY~W"},{"width":200,"visible":true,"property":"pzWp"},{"visible":true,"property":"B;[p"}]},"parent_id":"1d21f050-c8c4-41f3-9fd4-8ff7de49c962","parent_table":"block","alive":true,"page_sort":["b1e1d645-db95-42e5-8995-39a80eda6460","e8cd3732-dc1c-43ae-959a-a5a611ec098a","e876558d-e878-47f6-8c95-21be678990a5","5a971ded-d3c5-41be-bef9-ddfff48d43a2","8db8b240-e1c5-4dd7-bf74-72584d7a2ce0","daf94ca4-ec56-47a3-84ed-b1e2479acc4b","d1a2db9b-6820-421e-9b80-017ce7478587","67ea9f83-b9f6-416b-afcb-7c64f7533e6c","45939470-9819-47e8-b12b-999cfefa0aad","c60dc33d-8efb-44be-a863-7a87ad047932","fe4b8d5f-7c49-42c6-a7d5-1cb71c4f7e86","b7233a67-c367-4198-831e-f12089568d1f","4f3bf306-92c4-41b7-a43e-957129a1240a","6a789607-66cf-498e-9b32-eb3fa69a84f4","c9429034-dabd-4a25-8782-97f20c808a60","38c49fe2-37f8-4a7f-a99f-9edb9ddad4c2","474eb638-9f6b-46bf-8004-77668293f199","81d6dfab-69cb-43a0-aa04-e9725f0b67e1","7703d956-84db-46cd-b538-48eae1af68b5","9f937c73-dac9-4ed7-9b01-beefcb321f16","3cf9dcb9-e7db-406c-80ab-c65c11fbf906","5827ab53-e051-455b-b90a-3bdc20158c2c","fa7acd3b-dea9-4fb1-b859-5345f35163c6","696dfc48-62c3-494d-96d0-ec5fa84637e8","79df93cf-9b10-452e-bc62-f39e8cd2d124","9bb8e52d-c459-4528-b1b3-c2378207253a","5da038ef-f419-4a11-aa48-587b3787e040","b4a2c9d4-6a2c-49e6-988d-89a538dfe0f6","c374a479-5cc7-4c54-ba69-6a4d76dc25ad","d470fa67-0e7c-40d8-86ac-9b5a8be88dc8","986be38b-9780-4bb9-bdcd-4e361ddbd888","b7613f56-c2d4-4aae-b967-b7471ade86d0","e357d1fc-7466-4d6a-8d48-71b76ea97cdc","e1735855-4089-4af6-bd4d-0d59f7a76cb4","9b34581a-955a-4229-99d0-8f2a6d0e69ce","b4414811-0599-45cf-b047-fa95eac42d89","c28a8a01-911a-40a2-a607-d3af8cb24017","461d07ae-4b4a-49de-bdcb-341af1153201","3df59023-cb68-4a65-afd1-7f0b8c21cb57","0e3223d1-03df-40fb-90f9-cc8559d776b5","4f45b7d6-cd5b-46ab-b2a6-37ae20bf5f21","fa475a21-5f38-43d4-9a89-67c40b3129ae","97cbc634-fe3a-4b9b-9da6-ac4aaa94772f","8a0d34bc-7e8c-4a68-88a5-5276274f612a","623f8788-a20f-45fd-bb82-08935f59b44d","7ee398f0-450b-47cb-9b53-f5e7736590d2","eae9f077-591e-4841-903b-db395513c834","367d0f2a-0b10-4dbb-b53a-613152f124f9","398e2e28-3997-49bc-a138-0467d4da8531","8aaf4633-e879-44dc-82c8-3c9fb9d3a6f8","1eb5e5f2-8dc9-4ffc-b5e1-09b67be27a83","83465fb9-205b-41fc-83a6-424692ee0a0e","fb1d18d0-6403-4e8a-840e-134553748ff5","4407cb77-3838-4ba5-b474-f15222cd3dba","1880b0f2-e036-42d0-9550-0fb08a962397","d8d60bd6-33f6-458f-a7d6-209ef2fb05a1","29bf65ff-888b-4a76-a8dd-bf54f02c3864","bad1d4ae-fd4a-4671-ae94-dd53d94e0eae","0d59792d-db1c-4ae7-8d7c-4f013be40dcf","337dc259-2805-4b1c-a60f-1b3e6c7badb8","4b1b21a8-c278-4bc6-88f1-1a35d407f4d7","7946aba2-d6d0-45ef-8779-23fa15db8f2d","c18dbce6-9e8c-4f4b-b74a-0994e7c1bc3f","84aa87b7-39e7-493c-87b9-5cae4de95449","1446eadb-8c01-4295-be3a-ecf19361c143","fe8a7d94-e9ba-457d-8f19-10fe53e6ca3c","98a5a0b6-b07b-4065-a73f-2949ad28ac47","38e3e030-5423-4343-b944-083b96fd8656","7dc3700b-1183-4e44-b4bb-cb500ae0b363","975051d4-ebbc-4b3f-98cf-1a52e5e4761d","e5d98bee-b2d5-4b45-ab0b-b77da24aebe7","acac2668-1062-4e7a-b095-eda067da8413","179025c4-d8a8-4c47-b621-9fd6a6f3339b","d256e5ed-5eac-43bb-a32e-581774962c23","3531b347-b0c9-406a-97ec-dc1233b52619","3760aeb0-084a-4e6d-88da-54a3c0311402","9c40a253-b9e8-42cd-8a99-62aaa9789a5e","f3c75b97-fd39-40bc-9473-2beb74d837b1","4d9edb9d-6ecd-4f3c-b41a-395987d6a714","c00f43c1-0fd5-45ca-a8af-e65a0bd6c990","9179759d-2b61-41a8-964e-23719e022b2d","19ad7e3a-2736-4d60-9516-6fcda35ed534","fe12b6af-37a2-4eab-a32f-5379fe881886","3634923c-2faf-4a31-a356-6ce9830706fb","6d9c82b0-2b20-425f-a87b-c9b14752bf9d","b57ebe77-5397-4ae8-b342-d19e3554f49c","1009ed18-593a-4ae7-8b32-7c39733138b5","d1d27099-40f0-4c1d-9c3b-a62349291ed2","f3ac9402-f3e4-4dc6-ae57-03d81bfd4e03","c1a9215b-4b3e-4d97-be31-f5d28736a065","8c80a9e1-a9d5-4b96-9a84-26df209c9537","ed91e3f2-5735-4c46-97db-aec5e6c4f597","7364073f-b7c8-436c-a471-779c7775fbf8","0f0ad844-b657-47c1-a04a-61d01ed706c1","6e55a5aa-680a-439d-add1-56498538aa64","7367ec26-da0a-441e-81b4-ae21068b94cf","48636b1e-62eb-449d-80db-68ee12d3caa8","f1c7db1e-871a-4529-9ba8-cd04f43979da","49477ffa-3ecf-49a3-a12d-62bea76192fc","1e50a8aa-3628-4b23-bd39-af65962e7061","fd0f48e9-d102-4502-9d06-94f78405f07a","51e53e64-e6dd-4fd6-8062-5d4455f0a1cb","f4ec684b-e5f1-44e9-a8a7-aca27f7ca6f3","177fa228-9099-4dd5-8969-c67f9c78bd0c","d5ab0d7a-0123-473f-84d4-81740defb9b4","548f6d36-c509-4b79-9c4b-59f227c7f550","c0901673-4f5e-4e51-ad87-0217f2d33a0c","0787f8d6-dc99-47c6-946e-2b008814bebc","0ade5216-1103-486a-aff0-a709ff825b02","a2c4dd21-985c-497d-b421-c2d8a9ec0eeb","908a498c-f7e3-4668-8afd-f179a027b4d9","4945e5c3-033d-467c-a8b3-b1479c1fdf0a","854f4584-28d5-43bd-938e-88d0957c78e3","6a6574f8-d63d-4fed-99c5-38f3df0364ac","baa9bf33-a11f-4da5-80eb-7930448aaad1","586d7983-2a0e-47ee-b80c-2800696255da","24f98f49-407b-4f0c-b90b-7cb436c0063d","5625b2fb-6c82-4130-b336-0ec9a19d28ef","be5d776a-0cae-4ad0-b823-fc7c1371aca9","951d4753-cc76-4e10-9427-bc1517d34a8c","e7f7db5d-3e80-4afb-a4a8-4863c5302031","14b6937e-c536-48c7-95f8-b71b569ebc4d","ed276d45-3e91-40f4-b3f7-559061948489","0001a0d6-5549-4fc5-955f-57c356d6e87e","31a25d19-9261-43ad-b43e-a31d39f64545","7f5ff12b-b543-473c-9e05-bfba5d7dabff","69fd45e6-5797-4294-8c16-f0ba0a91ad5c","01ffb8be-f877-42b4-ba13-92ad393a7e6c","060867a6-c2c6-4a7c-a282-403e4081d6e4","e8704a7f-e816-4458-ae8a-0f9bc9f144b5","bbb78d74-fe80-4da0-9585-a2ef20ab4d1a","e6582267-a054-41b3-80ab-fb860956d3c5","91edf54b-8f96-4f4f-a127-f0b6435a56eb"],"query2":{"filter":{"operator":"and"},"aggregations":[{"property":"title","aggregator":"count"}]},"space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"}}},"notion_user":{},"collection_query":{},"signed_urls":{"c7c47b04-1c69-4ac2-979c-f12c9735d48a":"https://s3.us-west-2.amazonaws.com/secure.notion-static.com/1d57b8cd-39e8-491f-98d8-b58d4d173842/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Content-Sha256=UNSIGNED-PAYLOAD\u0026X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20221216%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20221216T105818Z\u0026X-Amz-Expires=86400\u0026X-Amz-Signature=9c9f86bb19524627622c39bc82193f2c57ed0b8151c0f534f2e2d3fe9aef6b4f\u0026X-Amz-SignedHeaders=host\u0026x-id=GetObject","93767f90-a23c-428a-ad6b-c2e7e1fb89ca":"https://s3.us-west-2.amazonaws.com/secure.notion-static.com/089431dc-95ae-47ea-a360-feb9284f2379/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Content-Sha256=UNSIGNED-PAYLOAD\u0026X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20221216%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20221216T105818Z\u0026X-Amz-Expires=86400\u0026X-Amz-Signature=85de06bc886b15590bf6e219e8d96e18483f98dfcb6cc2865071bbba8fc0cceb\u0026X-Amz-SignedHeaders=host\u0026x-id=GetObject","f04df273-9e77-46c9-83ed-0031299f88d0":"https://s3.us-west-2.amazonaws.com/secure.notion-static.com/9c456516-c885-4335-8d79-cd694989abf7/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Content-Sha256=UNSIGNED-PAYLOAD\u0026X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20221216%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20221216T105818Z\u0026X-Amz-Expires=86400\u0026X-Amz-Signature=e9527dfc3ad7845f1a7ef60a2ad9118151b12fd7d050004e3d5a1b54753afd80\u0026X-Amz-SignedHeaders=host\u0026x-id=GetObject"}},"emailHash":"c8089598dc27a7944c95a8ed30867b78"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"mutex"},"buildId":"gbspoaI5Kfubj7D-lJTwS","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>