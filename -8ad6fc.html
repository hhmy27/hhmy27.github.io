<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📖&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>《网络是怎样连接的》笔记&nbsp;|&nbsp;Notablog</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="《网络是怎样连接的》笔记">
  
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📖&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😀&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>关于我</span>
        </div>
      </a>
    
  
</nav>
  <header class="Header">
    
      <div class="Header__Cover">
        <img src="https://www.notion.so/images/page-cover/nasa_earth_grid.jpg">
      </div>
    
    <div class="Header__Spacer ">
    </div>
    
    <h1 class="Header__Title">《网络是怎样连接的》笔记</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Wed, Nov 9, 2022</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--purple">
            <a href="tag/计算机网络.html">计算机网络</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/8ad6fca7ef6d42d7b293cc9e4e986f23" class="PageRoot"><ul id="https://www.notion.so/cc56ca87bc9f431d9c77152b9d3fb419" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/5c8af3808ca4460d911546a207cabba1"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">简介</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/fb919ab6a65a4d4e9417048478072ffb"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">大体流程</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/872fa7f7cccc4514b942bcf34653b93d"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">浏览器 —— 输入URL，构造HTTP数据包</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b30e4bc65dd346599ca82e4a8fb1486e"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">客户端查询DNS服务器 —— 获取目标IP地址</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ebdf12cacb42446892bf6b92cf440cd3"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">TCP/IP协议栈与socket —— 概念</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/809a0a7cfca34dc4add760ba578fa1d4"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">TCP/IP协议栈的工作流程</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5e39ab88802945ce87781f56d44370f9"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">构造数据包</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/edf0ae5994e6443c92687fb829412522"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">传输数据</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/1c94f29e6cce4b2392b373e0b333e1c9"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">web服务器处理</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/fc76fed51c79493d939a2fc18d81b229"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">TCP/IP协议栈的具体细节</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/2b6102f7873f4638878986837d77d43d"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">TCP的控制字段</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5a319a3bf2d242df985671272198da16"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">三次握手</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/353a3061d0a9422ba2d9c0687a432691"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">信号传输</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/47b1f7ee1ab24de78e5fb80a2dc43242"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">消息的确认</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4229a193cf57460cbf5aebc3179f5271"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">消息重传和滑动窗口</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/5d4e1ea475c04894ac0c9db073d847d8"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">拥塞控制</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/85c9c90f126a4ee4b49569b21d8ed375"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">四次挥手</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/8c6e2c25b8ea4989919873b0b71d8862"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">从socket的角度看TCP/IP的工作</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/275732cf83aa47cc86d1b13d057e2bc7"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">客户端的socket</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/896834d3237045f58dead80d39f6a959"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">服务端的socket</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/95420222a9434d95b6af7d8d41521751"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">三次握手中的socket</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f4b9f2c93b49453eb6998574fa8fc316"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">总结</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f5dae123d44b423c9bb776c45fc61cc3"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">参考</span></span></div></a></li></ul><h2 id="https://www.notion.so/5c8af3808ca4460d911546a207cabba1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/5c8af3808ca4460d911546a207cabba1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">简介</span></span></h2><div id="https://www.notion.so/dcddf652873d4b638c21bee05c383c7e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://book.douban.com/subject/26941639/">网络是怎样连接的 (豆瓣) (douban.com)</a></span></span></p></div><div id="https://www.notion.so/365a563b038748b6ad84c37a98a07b91" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">快速翻阅了一下这本书，内容主要是回答“浏览器输入URL到接收数据到底发生了什么”这个经典问题。</span></span></p></div><div id="https://www.notion.so/d9242149bb924449aeac37642ed6e8a5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/fb919ab6a65a4d4e9417048478072ffb" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/fb919ab6a65a4d4e9417048478072ffb"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">大体流程</span></span></h2><div id="https://www.notion.so/8462fc47dc3540b2b26d2a3f2dc23766" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F1877ed91-f05e-4df5-ba02-a1916c13e177%2FUntitled.png?width=1617&amp;table=block&amp;id=8462fc47-dc35-40b2-b26d-2a3f2dc23766"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F1877ed91-f05e-4df5-ba02-a1916c13e177%2FUntitled.png?width=1617&amp;table=block&amp;id=8462fc47-dc35-40b2-b26d-2a3f2dc23766" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/9b1eeefa62eb4255b9720628bd96235a" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">浏览器输入URL，查询DNS服务器（基于UDP）获得目标IP地址，构造HTTP请求报文，将HTTP请求报文交给TCP/IP协议栈</span></span></li></ol><blockquote id="https://www.notion.so/181a70351c064bdf921f16356c405f60" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">DNS服务器，HTTP控制协议</span></span></blockquote><ol class="NumberedListWrapper"><li id="https://www.notion.so/37dc7247bd1b442096f6677edcc547c3" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">TCP模块收到HTTP报文后，按照TCP协议封装数据包，然后创建socket进行链接</span></span></li></ol><blockquote id="https://www.notion.so/0fd45478961a41eea98019151b18e476" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">socket通信，TCP协议（三次握手、四次挥手、可靠传输）</span></span></blockquote><ol class="NumberedListWrapper"><li id="https://www.notion.so/ffdcb83ee40248d4838e8f2f11561e1f" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">TCP模块将TCP数据包交给IP模块，IP模块继续封装IP报文，然后通过网卡传输到路由器，由路由器进行转发</span></span></li></ol><blockquote id="https://www.notion.so/64e7f2addee340e781bb2b468b33e7ab" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">IP协议</span></span></blockquote><ol class="NumberedListWrapper"><li id="https://www.notion.so/351dc85434394464a882e5197f325891" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">路由器接力转发，直到进入服务器端的网络中（</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">入口路由器</strong></span><span class="SemanticString">）</span></span></li><li id="https://www.notion.so/72e57997371846a5bb48e6264a1f0dfe" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">防火墙过滤数据包，经过缓存服务器</span></span></li></ol><blockquote id="https://www.notion.so/8ce4b53a1dd444f28ff49cb76e89b7bc" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">这里缓存服务器的操作和HTTP字段有关</span></span></blockquote><ol class="NumberedListWrapper"><li id="https://www.notion.so/b517467ee2314101a87e8da01358dc88" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">数据包进到服务器（实际上是通过socket拿到数据），先是暂存在网卡缓存里面，等到CPU进行读取</span></span></li><li id="https://www.notion.so/34542363d0864a64974f5c5ed25286c3" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">CPU读取后，交给IP模块处理数据，此时根据协议号来决定交给UDP还是TCP（假设是TCP）</span></span></li><li id="https://www.notion.so/63f1ee3e41c04a14b3adda63ecdb1512" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">TCP收到数据报文后，根据首部字段决定操作</span></span></li></ol><blockquote id="https://www.notion.so/b739ba2ec1704185af1d3769fe695e97" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">如果SYN=1，则是建立连接的请求，进行三次握手
如果FIN=1，则是断开连接的请求，进行四次挥手
剩下的情况是数据传输过程的数据包，接收并处理</span></span></blockquote><ol class="NumberedListWrapper"><li id="https://www.notion.so/dc9da086a700485b86943cb42429d01d" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">TCP会将处理好的数据包交给HTTP模块，HTTP处理数据包，然后交给服务器程序进行处理</span></span></li><li id="https://www.notion.so/e96190bdcfa5472b8ec3b9d066e60636" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">服务器处理完毕之后，将内容封装成HTTP数据包，然后用同样的方式返回给客户端</span></span></li></ol><div id="https://www.notion.so/963f7c7fecb34225a32c29551f80273e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">下面还是从浏览器输入URL开始，到接收数据结束，详细讲解一下每一步发生了什么。</span></span></p></div><h2 id="https://www.notion.so/872fa7f7cccc4514b942bcf34653b93d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/872fa7f7cccc4514b942bcf34653b93d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">浏览器 —— 输入URL，构造HTTP数据包</span></span></h2><div id="https://www.notion.so/5a8d6a7eeba34611a9f343835276c96f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当我们输入URL之后，实际上构造的是HTTP数据包</span></span></p></div><div id="https://www.notion.so/92bf388c401145b18610b11df765c9f4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">URL是统一资源定位符的一种，它用来表示目标服务器上的一个资源，这个资源可能是网页，可能是图片、视频。</span></span></p></div><div id="https://www.notion.so/66766f9bf0a244f6a0e88737ee13f742" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb412d819-6e0a-4586-bf6c-d7cc218b0466%2FUntitled.png?width=1341&amp;table=block&amp;id=66766f9b-f0a2-44f6-a0e8-8737ee13f742"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb412d819-6e0a-4586-bf6c-d7cc218b0466%2FUntitled.png?width=1341&amp;table=block&amp;id=66766f9b-f0a2-44f6-a0e8-8737ee13f742" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/05ca8237dbb84aba8b4011a342849e94" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">例如我们输入一个网址，实际上对应的是目标服务器中的file1.html这个网页</span></span></p></div><div id="https://www.notion.so/b7ad264a2dcb4181bf7d77e328c3b575" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb2da6d36-2974-4d4a-96a0-b805ad2f38b3%2FUntitled.png?width=1349&amp;table=block&amp;id=b7ad264a-2dcb-4181-bf7d-77e328c3b575"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb2da6d36-2974-4d4a-96a0-b805ad2f38b3%2FUntitled.png?width=1349&amp;table=block&amp;id=b7ad264a-2dcb-4181-bf7d-77e328c3b575" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/443440a40fa54d21a1ecadba54eaea7b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">确定了URL之后，我们会根据用户发起的请求构造HTTP数据包。</span></span></p></div><div id="https://www.notion.so/8ea76c4c83ee426687df1d251364fabd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">HTTP数据包总的来说就是两部分：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/6fa99f86bb834cffad69a2e0410ca490" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">控制信息 —— 比如头部字段、请求方法、状态码等这些描述数据包信息的字段</span></span></li><li id="https://www.notion.so/125477d88ccb42ec96fa52cda4661ec2" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">数据 —— 需要传输的数据</span></span></li></ol><div id="https://www.notion.so/e88b2385284b47c084360cd666af3617" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff11844b2-0654-4c73-bc9b-037f7b76bc9f%2FUntitled.png?width=1359&amp;table=block&amp;id=e88b2385-284b-47c0-8436-0cd666af3617"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff11844b2-0654-4c73-bc9b-037f7b76bc9f%2FUntitled.png?width=1359&amp;table=block&amp;id=e88b2385-284b-47c0-8436-0cd666af3617" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/6f734ee59dbc4a85a82216a08b378070" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">而根据包的传输方向，可以分为：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/f420c8ee4d024378b6c4e8b99c9b7ad6" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">请求消息</span></span></li><li id="https://www.notion.so/e0ac985c44a9417e92df4993aa9bfb1d" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">响应消息</span></span></li></ol><div id="https://www.notion.so/51c6a8344a4e4f03b03446517981fcb7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">至此HTTP数据包构造完成，我们需要向目标URL的web服务器发送数据、</span></span></p></div><div id="https://www.notion.so/61a46eaa6c444d36ae4fbd3e1f6bdef9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">发送数据靠的是IP地址而不是URL，因此我们首先需要获取目标服务器的IP地址</span></span></p></div><h2 id="https://www.notion.so/b30e4bc65dd346599ca82e4a8fb1486e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/b30e4bc65dd346599ca82e4a8fb1486e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">客户端查询DNS服务器 —— 获取目标IP地址</span></span></h2><div id="https://www.notion.so/168c529ca289412fb428b143df9823ae" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当用户在浏览器输入网址时，浏览器首先会去DNS服务器查询域名对应的IP地址</span></span></p></div><div id="https://www.notion.so/4fe45c231ea4458ea0f10e1b25a669e9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">DNS服务器就像在远端维护的一个hashmap，key是URL，value是IP地址</span></span></p></div><div id="https://www.notion.so/1da53c81c73543e9aa9b52cac6715d8b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这一步可能涉及到多个DNS的接力查询。</span></span></p></div><div id="https://www.notion.so/8a1327b8f9614520b3e210d7b20bdd08" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">（所谓DNS污染就是在这一步破坏查询结果，如果我们拿到一个不正确的IP地址，自然没有办法进行通信了）</span></span></p></div><div id="https://www.notion.so/b2f34698e322446ba633e51f14e23a39" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F685f37da-4e58-446e-987b-a2c86b6e5811%2FUntitled.png?width=1223&amp;table=block&amp;id=b2f34698-e322-446b-a633-e51f14e23a39"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F685f37da-4e58-446e-987b-a2c86b6e5811%2FUntitled.png?width=1223&amp;table=block&amp;id=b2f34698-e322-446b-a633-e51f14e23a39" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/6b4b7173259b4d08bd30557ada9fb7bc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这一步是通过UDP协议查询得到结果，当我们查询到IP地址的时候，我们就可以准备发送数据了，接下来我们需要委托协议栈帮助我们发送数据</span></span></p></div><h2 id="https://www.notion.so/ebdf12cacb42446892bf6b92cf440cd3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/ebdf12cacb42446892bf6b92cf440cd3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">TCP/IP协议栈与socket —— 概念</span></span></h2><div id="https://www.notion.so/f5ebf9f03d4a4392aca603dc16873f15" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F91c449b2-c468-4be3-a312-e6a247458f83%2FUntitled.png?width=1247&amp;table=block&amp;id=f5ebf9f0-3d4a-4392-aca6-03dc16873f15"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F91c449b2-c468-4be3-a312-e6a247458f83%2FUntitled.png?width=1247&amp;table=block&amp;id=f5ebf9f0-3d4a-4392-aca6-03dc16873f15" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/703820fb05d846dba05903dea3098a04" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里协议栈指的是TCP、UDP、IP等这些网络通信协议组成的模块。</span></span></p></div><div id="https://www.notion.so/7d43d6547bab4feb94f6e1a8503dd0c7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">协议栈定义了一系列的通信规则，比如TCP的超时重传，建立连接、断开链接等规定，IP的校验码等。</span></span></p></div><div id="https://www.notion.so/324ca3d2316a4916987da0e2aa84cfdb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这些通信规则相当于约定，当我们双方都遵守约定的时，就能达到某种通信效果。</span></span></p></div><div id="https://www.notion.so/12a4f97dcbf9449a994d521978618d13" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">比如TCP可以在不可靠的网络环境下建立起可靠的通信信道。</span></span></p></div><div id="https://www.notion.so/7fb95b46cda94faebb401e4f35fe90c9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">表面上我们使用协议栈就进行通信，但是实际上我们还需要</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">socket（套接字）</strong></span><span class="SemanticString">的帮助。</span></span></p></div><div id="https://www.notion.so/c82f790744574a049f88e246f526f515" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fd520d362-8256-46f7-8004-166b4fbab2b4%2FUntitled.png?width=1244&amp;table=block&amp;id=c82f7907-4457-4a04-9f88-e246f526f515"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fd520d362-8256-46f7-8004-166b4fbab2b4%2FUntitled.png?width=1244&amp;table=block&amp;id=c82f7907-4457-4a04-9f88-e246f526f515" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/1c6d75dd4db44e8486c2db1d47675d16" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">形象一点的比喻是：TCP/IP协议是电，socket是插座。当一个管道两端都插上插座，电才能在管道中传输。</span></span></p></div><div id="https://www.notion.so/f028f287ad3741e98b6b0ff785f08f9b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这个比喻背后蕴含的意思是：TCP/IP等协议是对数据内容的抽象，规定数据内容供双方通信；而socket是通信实际实现的工具，没有socket我们无法传播信号。</span></span></p></div><div id="https://www.notion.so/b29706a7ca3c4937a5312ca316da274a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">明白了协议栈和socket的概念后，我们来看看它们是怎么运行的。</span></span></p></div><h2 id="https://www.notion.so/809a0a7cfca34dc4add760ba578fa1d4" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/809a0a7cfca34dc4add760ba578fa1d4"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">TCP/IP协议栈的工作流程</span></span></h2><div id="https://www.notion.so/b93a607197c442109a3914ba121f4d5f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">TCP/IP协议栈的工作是复杂的，下面我从一个数据包的流动来描述整个过程，中途涉及到的知识点后面再具体展开。</span></span></p></div><h3 id="https://www.notion.so/5e39ab88802945ce87781f56d44370f9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/5e39ab88802945ce87781f56d44370f9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">构造数据包</span></span></h3><div id="https://www.notion.so/c77fbd13f6e84be0b469835b634ae371" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">首先我们介绍数据包如何构造：</span></span></p></div><div id="https://www.notion.so/09d3db892ae6478485d8078b71f594b3" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa0ac7928-ab93-4ec2-870b-ebbd357707e2%2FUntitled.png?width=1246&amp;table=block&amp;id=09d3db89-2ae6-4784-85d8-078b71f594b3"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa0ac7928-ab93-4ec2-870b-ebbd357707e2%2FUntitled.png?width=1246&amp;table=block&amp;id=09d3db89-2ae6-4784-85d8-078b71f594b3" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/39bffbf354074fdea3539c2d73ccad8c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当我们把HTTP数据包构造完成后，首先交给TCP模块。</span></span></p></div><div id="https://www.notion.so/d9c3045d71544a2c96f9b686a6af7965" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">TCP模块会根据实际情况将数据进行拆分，然后写入自己的头部控制信息，这一步是在构造TCP数据包，当TCP数据包构造完成后，会交给IP模块处理。</span></span></p></div><div id="https://www.notion.so/77a6fd324e914f52954e1bc1b8bc518e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">IP模块收到TCP数据包后，会添加IP协议的头部控制信息。</span></span></p></div><div id="https://www.notion.so/943b922ff4654778868198084991bcdd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里涉及到两个长度：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/2577f3028f0648538a93d9129cfa6cd7" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">MTU：IP数据包的极限大小，一般是1500字节</span></span></li><li id="https://www.notion.so/463ec48bdb224c62ab734adfcddb2949" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">MSS：IP数据包最大的数据量，一般是1460字节，40字节是IP头部信息的占用大小。</span></span></li></ol><div id="https://www.notion.so/f5049c203c9f47e8aa851ba812f005b6" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F64d052ba-9e4a-4c29-a39b-5f3cbabd5732%2FUntitled.png?width=1230&amp;table=block&amp;id=f5049c20-3c9f-47e8-aa85-1ba812f005b6"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F64d052ba-9e4a-4c29-a39b-5f3cbabd5732%2FUntitled.png?width=1230&amp;table=block&amp;id=f5049c20-3c9f-47e8-aa85-1ba812f005b6" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/9c0c05c244c8446d81ea3bb9b4b081ee" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">直到这里我们传输用的数据包就构造完成了。</span></span></p></div><h3 id="https://www.notion.so/edf0ae5994e6443c92687fb829412522" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/edf0ae5994e6443c92687fb829412522"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">传输数据</span></span></h3><div id="https://www.notion.so/b0a9e2f1ab204a96ad7abb0392ecb250" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2af009a6-98a4-4888-87f9-19aca1ad652f%2FUntitled.png?width=1248&amp;table=block&amp;id=b0a9e2f1-ab20-4a96-ad7a-bb0392ecb250"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2af009a6-98a4-4888-87f9-19aca1ad652f%2FUntitled.png?width=1248&amp;table=block&amp;id=b0a9e2f1-ab20-4a96-ad7a-bb0392ecb250" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/36da14483e214ac88c418a4ddb6d6c54" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们将数字信号的数据包交给网卡，然后网卡会将数据发送给路由器（中途可能有集线器和交换机，还有传输依赖的网线，这里忽略掉它们的工作），路由器多次转发后，可以找到服务器所在的网络，然后根据IP地址转发至web服务器</span></span></p></div><h2 id="https://www.notion.so/1c94f29e6cce4b2392b373e0b333e1c9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/1c94f29e6cce4b2392b373e0b333e1c9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">web服务器处理</span></span></h2><div id="https://www.notion.so/d78b55ac563f41738e5ca5c0506c2890" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里web服务器整体收到数据包的过程是这样的：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/abd858251ed9495fa731e2f188fbae2a" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">防火墙过滤</span></span></li><li id="https://www.notion.so/c0f426f777d9477e9f84f46552b205da" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">如果有缓存服务器，经过缓存服务器</span></span></li><li id="https://www.notion.so/2639f52f32d14cf98b54af5979989c51" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">web服务器网卡收到数据包，检查IP数据包是否出错，没有出错的话通知CPU读取</span></span></li><li id="https://www.notion.so/dd744213dfdc41bea44e6e5c8e75da0e" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">CPU读取后，根据IP数据包的协议号交给TCP或者UDP模块处理，这里HTTP依赖TCP，所以交给TCP梳理</span></span></li><li id="https://www.notion.so/c56e072546114b7fb5c3f7166070f2f1" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">TCP模块收到数据包后会检查头部字段是否正常，如果正常，交给web服务器软件进行处理。常见的web服务器软件有tomcat、jetty等。</span></span></li><li id="https://www.notion.so/ed7be98141684f35995ee5a6d34cc0e0" class="NumberedList" value="6"><span class="SemanticStringArray"><span class="SemanticString">web服务器软件读取到头部信息和数据，针对要求执行具体操作，比如说HTTP GET操作或者HTTP POST操作，这一部分的处理方法是我们写的业务代码。</span></span></li></ol><div id="https://www.notion.so/a7247084b57f41e3a781ebf3727c7af8" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4be33d7b-3695-458a-881c-ca58acb07b88%2FUntitled.png?width=1194&amp;table=block&amp;id=a7247084-b57f-41e3-a781-ebf3727c7af8"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4be33d7b-3695-458a-881c-ca58acb07b88%2FUntitled.png?width=1194&amp;table=block&amp;id=a7247084-b57f-41e3-a781-ebf3727c7af8" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/d2e9adb6cb91476dad9f91a771a0272b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当我们处理完毕后，会按照反过来的顺序进行传输，最终就能传输到客户端的浏览器里面，然后浏览器会根据数据进行相应处理。</span></span></p></div><h2 id="https://www.notion.so/fc76fed51c79493d939a2fc18d81b229" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/fc76fed51c79493d939a2fc18d81b229"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">TCP/IP协议栈的具体细节</span></span></h2><div id="https://www.notion.so/8697531c046a46a8882024dd3a643adf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">上面对TCP/IP协议栈的工作流程做了简要的叙述，这里我们拆开来仔细看每一步到底是怎么工作的。</span></span></p></div><div id="https://www.notion.so/e4a9babb2c704f3c8eacdc50a98940a8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们都知道，TCP协议建立的传输有三个结果：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/447758a57a62499f96a568cac5253d68" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">三次握手</span></span></li><li id="https://www.notion.so/2885b8af50d04b32a892a46a883674de" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">信号传输</span></span></li></ol><ul class="BulletedListWrapper"><li id="https://www.notion.so/1d0bb6276e1b43f6896b04a1039eb98c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">这里涉及到拥塞控制，可靠传输等知识</span></span></li></ul><ol class="NumberedListWrapper"><li id="https://www.notion.so/8ef5ca059b554ddd97d42da19cac14c0" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">四次挥手</span></span></li></ol><div id="https://www.notion.so/47d4ecb5aa5945509fa636fc1cae9984" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">下面我们详细描述一下流程</span></span></p></div><h3 id="https://www.notion.so/2b6102f7873f4638878986837d77d43d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/2b6102f7873f4638878986837d77d43d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">TCP的控制字段</span></span></h3><div id="https://www.notion.so/6409d086dac3449fba51b692f051b545" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">之前提到协议栈里面的数据包，其实都可以笼统的看为两部分的内容：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/d6c4d2442d714e6f99b0cfa0f5fa0241" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">控制信息</span></span></li><li id="https://www.notion.so/b58341c06deb490ea46044716c8679d2" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">数据</span></span></li></ol><div id="https://www.notion.so/3a669273960c4418bec551bee4f76cb0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">控制信息是对要传输的数据进行描述，TCP的控制信息如下图：</span></span></p></div><div id="https://www.notion.so/26b29f595bd04defa7ba64d1e2062e34" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fd5e30091-f0eb-450d-abc0-7ff016f6fe61%2FUntitled.png?width=1359&amp;table=block&amp;id=26b29f59-5bd0-4def-a7ba-64d1e2062e34"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fd5e30091-f0eb-450d-abc0-7ff016f6fe61%2FUntitled.png?width=1359&amp;table=block&amp;id=26b29f59-5bd0-4def-a7ba-64d1e2062e34" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/89da96ebcdee4187aa03d73e96d5f3f5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们需要注意的地方是：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/89baa76380c144c7805b8a8a38b6b805" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">发送方端口号，接收方端口号</span></span></li><li id="https://www.notion.so/e4c5e9d08f9247318784a20e08d92b71" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">序号，ACK号</span></span></li><li id="https://www.notion.so/834c2ac982a84e2a8f77ab9cf6b20f4a" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">控制位</span></span></li></ol><ul class="BulletedListWrapper"><li id="https://www.notion.so/5267d750191742588945b34c76b538f5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">其中ACK、SYN、FIN是常见的控制位</span></span></li></ul><ol class="NumberedListWrapper"><li id="https://www.notion.so/86089306bd1841059d4276e1cb4d9346" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">窗口</span></span></li></ol><h3 id="https://www.notion.so/5a319a3bf2d242df985671272198da16" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/5a319a3bf2d242df985671272198da16"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">三次握手</span></span></h3><div id="https://www.notion.so/432c12b4c1af49f4b4526767cdf17f4d" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2a99216c-4873-4fe5-8672-cbf3b09a0bd1%2FUntitled.png?width=1066&amp;table=block&amp;id=432c12b4-c1af-49f4-b452-6767cdf17f4d"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2a99216c-4873-4fe5-8672-cbf3b09a0bd1%2FUntitled.png?width=1066&amp;table=block&amp;id=432c12b4-c1af-49f4-b452-6767cdf17f4d" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/116d0e21ef0c4c1ab3181877a543927b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">三次握手</span></span></p></div><div id="https://www.notion.so/f1881827a992472d8ead242b2207de17" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">三次握手大家都很熟悉了</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/a303c8ad84f749c8b6aee2aa1b1a48a1" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">客户端发送SYN = 1的TCP数据包，请求建立链接</span></span></li><li id="https://www.notion.so/ecdb07ec8cd3472abe5a2c5a604a642f" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">服务器收到后，返回SYN=1，ACK=1的数据包，表示同意建立链接</span></span></li><li id="https://www.notion.so/1ce4f58f57bf445ab6ebe4612bbdc124" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">客户端收到后，返回ACK=1的数据包，表示收到同意</span></span></li></ol><div id="https://www.notion.so/e5740af37a30429e9494571da187b4da" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">经过三个步骤，一个可靠的传输信道就建立起来了，接下来就可以进行数据传输了。</span></span></p></div><div id="https://www.notion.so/a340b0a2b5f24eac9d89b09ca9e287bd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">然而这里面有几个问题</span></span></p></div><blockquote id="https://www.notion.so/b7427c64b6164c9fb645d34c146e3587" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">TCB是什么？为什么是三次握手？SYN-SENT和SYN-RCVD是什么？</span></span></blockquote><div id="https://www.notion.so/9b29de87f6224f9193011a60029b015c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">TCB是什么？</strong></span></span></p></div><div id="https://www.notion.so/67682f530c1c4c40b63984be8bfa846e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">TCB（Transmission Control Block，传输控制块）</strong></span><span class="SemanticString">是TCP用来传输数据的数据结构，它的组成是两个部分：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/7a485a7022ba4779883fbcc460571075" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">socket，读写数据，传输</span></span></li><li id="https://www.notion.so/94944b05878645fe9a277b1f64e5a91a" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">缓冲区，存放数据</span></span></li></ol><div id="https://www.notion.so/9a9396ced7c34a6d8716a4815515f28f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们所谓的通信，实际上是TCB之间的通信。</span></span></p></div><div id="https://www.notion.so/82c5cf30f644445d81e3906257f2cc9b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">为什么要三次握手？</strong></span></span></p></div><div id="https://www.notion.so/3bc38abbe5344068b1cc987d4317eba6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这部分可以参考下面的文章，写得很好，这里不赘述了。简单来说有以下三个特点：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/b83370754987437bb5976ffed5825c13" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">三次握手才可以阻止重复历史连接的初始化（主要原因）</span></span></li><li id="https://www.notion.so/71932b08d60a4ece957d734a22fd6f7e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">三次握手才可以同步双方的初始序列号</span></span></li><li id="https://www.notion.so/0a9a9fd246b643d9b5df2d791ef35133" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">三次握手才可以避免资源浪费</span></span></li></ul><div id="https://www.notion.so/26e53c2e6fff40f3a457b08323bae2ee" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://xiaolincoding.com/network/3_tcp/tcp_interview.html#tcp-%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B">4.1 TCP 三次握手与四次挥手面试题 | 小林coding (xiaolincoding.com)</a></span></span></p></div><h3 id="https://www.notion.so/353a3061d0a9422ba2d9c0687a432691" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/353a3061d0a9422ba2d9c0687a432691"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">信号传输</span></span></h3><div id="https://www.notion.so/69ae43f8e55b44ac917d8edcc930b234" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里有三大部分：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/699ffaaf3c314230a2aa7a677a05acf5" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">消息的确认</span></span></li><li id="https://www.notion.so/1dcfe3d5591b44559ddfb76628060545" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">消息重传和滑动窗口</span></span></li><li id="https://www.notion.so/d3ee68fd72414e7ca8c6ed5df6d02e03" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">拥塞控制</span></span></li></ol><h3 id="https://www.notion.so/47b1f7ee1ab24de78e5fb80a2dc43242" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/47b1f7ee1ab24de78e5fb80a2dc43242"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">消息的确认</span></span></h3><div id="https://www.notion.so/cb42ed98352f4dc29ba35a104c9a1caa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们都说TCP是可靠的连接，那么TCP到底如何实现可靠连接？</span></span></p></div><div id="https://www.notion.so/1dbded21230140449c003ece5ff34f75" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">实际上这和序列号和TCP控制字段里面的ACK有关。</span></span></p></div><div id="https://www.notion.so/d4b0dfc7003441a2abd08ee77ee02f1c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb8f6d473-a6a8-4288-9635-2f7eb9bdb6bc%2FUntitled.png?width=1111&amp;table=block&amp;id=d4b0dfc7-0034-41a2-abd0-8ee77ee02f1c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb8f6d473-a6a8-4288-9635-2f7eb9bdb6bc%2FUntitled.png?width=1111&amp;table=block&amp;id=d4b0dfc7-0034-41a2-abd0-8ee77ee02f1c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/fe6ad3d672d14b829b9be41235315022" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9d9b9190-4a96-47e4-9a40-584d74625ee8%2FUntitled.png?width=1106&amp;table=block&amp;id=fe6ad3d6-72d1-4b82-9b9b-e41235315022"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9d9b9190-4a96-47e4-9a40-584d74625ee8%2FUntitled.png?width=1106&amp;table=block&amp;id=fe6ad3d6-72d1-4b82-9b9b-e41235315022" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/c79dae92068d4181a096afad4f680f21" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">上面这张图描述了ACK和序列号到底如何工作</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/b10abc9954c34dca947b764fdac2e6c2" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">客户端 =&gt; 服务端</span></span></li></ol><ul class="BulletedListWrapper"><li id="https://www.notion.so/2d22bd332d6c4861ab33ce675487693e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">当我们传输一个序号为1，长度1460的数据包时。服务端如果收到，会返回一个ACK=1461的数据包给客户端，表示1461字节之前的数据都已经收到了</span></span></li></ul><ol class="NumberedListWrapper"><li id="https://www.notion.so/2ba952fa83a1464193e8a360445ab63b" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">客户端 =&gt; 服务端</span></span></li></ol><ul class="BulletedListWrapper"><li id="https://www.notion.so/4be52c7086d241db945f76319d188d03" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">客户端收到ACK=1461的数据包后，继续传输接下来的字节</span></span><div id="https://www.notion.so/254f7b7c95914841afdbf8a681ed6ce6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">...</span></span></p></div></li></ul><div id="https://www.notion.so/4363c1bc535b4466a08aa5318d8d81b4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">如此，我们就能通过ACK和序列号来进行消息传输的确认</strong></span><span class="SemanticString">。</span></span></p></div><div id="https://www.notion.so/c2e1997d244248969de51ca1c9c53b1a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里的序列号是从1开始， 这种实际上是不安全的，因为外界可以根据序列号和ACK号分析客户端和服务器的通信情况</span></span></p></div><div id="https://www.notion.so/7a47c4a6e5844c0f936c009e394731d2" class="Image Image--PageWidth"><figure><a href="#?width=700"><img src="#?width=700" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/2f5a7ddc9c0044eea7c86167e5871aaa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">所以我们回过头来看这幅图，注意里面的</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">seq字段</strong></span></span></p></div><div id="https://www.notion.so/fe2aa6deadcc41548d3232e787e5f722" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这个字段是我们双方约定的随机开始的序列号，x是客户端约定的起点，y是服务端约定的起点，而ack是对起点的确认</span></span></p></div><div id="https://www.notion.so/eee9a59587124f5693fa230873bba458" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里我们就能避免上述不安全的情况。</span></span></p></div><h3 id="https://www.notion.so/4229a193cf57460cbf5aebc3179f5271" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/4229a193cf57460cbf5aebc3179f5271"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">消息重传和滑动窗口</span></span></h3><div id="https://www.notion.so/3609851f1d414ffd8e848942dcaeff52" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">上面提到的传输是理想的情况，实际传输的时候可能会发生丢失，这个时候就需要重传机制了。</span></span></p></div><div id="https://www.notion.so/338eb9793e2d45a6a5dce702ad502b0b" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F16fc34ba-711f-47d7-b8da-64deebc53abb%2FUntitled.png?width=1086&amp;table=block&amp;id=338eb979-3e2d-45a6-a5dc-e702ad502b0b"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F16fc34ba-711f-47d7-b8da-64deebc53abb%2FUntitled.png?width=1086&amp;table=block&amp;id=338eb979-3e2d-45a6-a5dc-e702ad502b0b" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/3b1803adadef4938808f50a99650e03c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">实际上传输并不是一来一回，而是通过双方维护的一个滑动窗口进行传输</span></span></p></div><div id="https://www.notion.so/3a469faf908e48d78f6ee6c5d2321e7f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">对于客户端：发送滑动窗口内的数据，当收到ACK=x的时候，滑动窗口的左端移动到x+1的位置</span></span></p></div><div id="https://www.notion.so/0a5898e37bdb439198acb3f09d2c7e4d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">对于服务器：接收滑动窗口内的数据，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">当x之前的数据都已经收到的时候</strong></span><span class="SemanticString">，返回ACK=x的数据包</span></span></p></div><div id="https://www.notion.so/a2245f79357e444997988571219d24e8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">注意我们服务器是收到x之前的所有数据才会返回ACK=x，这样能确保数据的连续性。</span></span></p></div><div id="https://www.notion.so/ef04b4c4090743be97980630b711a232" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">那么我们ACK丢失的情况呢？TCP应该怎么处理？</span></span></p></div><div id="https://www.notion.so/c149a37cff8a493f9726ff96624b5047" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">实际上这涉及到重传机制了，重传分为四种</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/ac3920d8623049f4aab2516e39efff13" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">超时重传</span></span></li><li id="https://www.notion.so/6000467949d34c2aba5be91edec97abb" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">快速重传</span></span></li></ol><div id="https://www.notion.so/6ac33db4b26c4c758b438df11221c416" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">什么是超时重传？</strong></span></span></p></div><div id="https://www.notion.so/070f4b97766d483590929b5ae81abf24" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ACK数据包丢失了，此时客户端并不知道对方是否收到数据，所以客户端会</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">等待一段时间</strong></span><span class="SemanticString">，超过了这个时间后会重新发送数据包</span></span></p></div><div id="https://www.notion.so/5ec0aed13e2048579516ca36a4a5f20a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">那么等待多久比较合理呢？</span></span></p></div><div id="https://www.notion.so/d3684d398ef44564b0c14adf4581a44d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里涉及到两个概念：</span></span></p></div><div id="https://www.notion.so/cf74b5436bc64190be693a7726b97b22" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">RTO</code></span><span class="SemanticString"> （Retransmission Timeout 超时重传时间）</span></span></p></div><div id="https://www.notion.so/9d327cf714704f15a4e2139976d4997e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">RTT</code></span><span class="SemanticString"> 就是</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">数据从网络一端传送到另一端所需的时间</strong></span><span class="SemanticString">，也就是包的往返时间。</span></span></p></div><div id="https://www.notion.so/76b66f62f5804fbea67cf01fd11f8ac7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">RTO的值会略大于RTT，而它们具体的值会由网络环境决定</span></span></p></div><div id="https://www.notion.so/43c123ce3a0a40a58bc24d7339c80392" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">什么是快速重传？</strong></span></span></p></div><div id="https://www.notion.so/26b4571755b7427ab4c6ac132fc981e2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">存在一种情况，ACK数据包没有丢失，但是服务器反复发送</span></span></p></div><div id="https://www.notion.so/612383adfbb041b9b700149213ea8b72" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当客户端收到3次相同ACK=x的时候，立即重传ACK=x+1的数据包</span></span></p></div><h3 id="https://www.notion.so/5d4e1ea475c04894ac0c9db073d847d8" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/5d4e1ea475c04894ac0c9db073d847d8"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">拥塞控制</span></span></h3><div id="https://www.notion.so/9a603b0a5e8f4229a7a48d0c8af02a46" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">拥塞控制是指我们应当有节制的发送数据包到网络环境中，因为网络环境是公用的，一个地方阻塞必然造成整个网络的阻塞，TCP针对这种情况设计了阻塞机制。</span></span></p></div><div id="https://www.notion.so/81737f8c11d3447382b7f4adebedf339" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里涉及到两个重要参数，一个是cwnd即滑动窗口大小，另一个是ssthresh窗口的临界值，分别有四个要点：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/6a24b7fd848d470d85d0c98e9c4195d8" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">慢启动</span></span></li></ol><ul class="BulletedListWrapper"><li id="https://www.notion.so/34a55c31e9fb4724b1eca0eaa47999b4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">cwnd = 1，指数速度增长</span></span></li></ul><ol class="NumberedListWrapper"><li id="https://www.notion.so/9645dd2adb8c4b5181e2440ce5f1c579" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">拥塞避免</span></span></li></ol><ul class="BulletedListWrapper"><li id="https://www.notion.so/52026688c239411ea87f6c1da3cf1310" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">cnwd &gt;= ssthresh时，cwnd += 1</span></span></li></ul><ol class="NumberedListWrapper"><li id="https://www.notion.so/6f52aaa3de6047cfbd31d04dfb5b6b94" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">快重传</span></span></li></ol><ul class="BulletedListWrapper"><li id="https://www.notion.so/b923b1e63ed24b95ad57c1d3f9e96b49" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">当客户端收到3次相同ACK=x的时候，立即重传ACK=x+1的数据包</span></span></li></ul><ol class="NumberedListWrapper"><li id="https://www.notion.so/13c6c8ffae6f4aa695a4d6d16d42c9d9" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">快恢复</span></span></li></ol><ul class="BulletedListWrapper"><li id="https://www.notion.so/a6fab5529766436da6bb09bc54bb5259" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">发送拥塞时，ssthresh /=2 ，cwnd /= ssthresh，然后执行拥塞避免算法</span></span></li></ul><h3 id="https://www.notion.so/85c9c90f126a4ee4b49569b21d8ed375" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/85c9c90f126a4ee4b49569b21d8ed375"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">四次挥手</span></span></h3><div id="https://www.notion.so/60a2792098504132b37b31a51917652c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff2f310fb-e7e0-4eed-8f17-880c3cf2a970%2FUntitled.png?width=1066&amp;table=block&amp;id=60a27920-9850-4132-b37b-31a51917652c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff2f310fb-e7e0-4eed-8f17-880c3cf2a970%2FUntitled.png?width=1066&amp;table=block&amp;id=60a27920-9850-4132-b37b-31a51917652c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/04b3a3d731f24521b6bfccdbc60dcafa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当我们数据传输完毕后，TCP将会断开连接。</span></span></p></div><div id="https://www.notion.so/f1155bcf310542cb94268685b1c1c253" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这里断开链接的过程是四次挥手，过程以上图为例：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/11cf23a0f6c54e278690f2e0d4e00b69" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">客户端进程发出连接释放报文，并且停止发送数据。释放数据报文首部，FIN=1，其序列号为seq=u（等于前面已经传送过来的数据的最后一个字节的序号加1），此时，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">客户端进入FIN-WAIT-1（终止等待1）状态</strong></span><span class="SemanticString">。</span></span></li><li id="https://www.notion.so/0fcfadeb6fd74aeea8e9b2aa87a13e5f" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">服务器收到连接释放报文，发出确认报文，ACK=1，ack=u+1，并且带上自己的序列号seq=v，此时，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">服务端就进入了CLOSE-WAIT（关闭等待）状态</strong></span><span class="SemanticString">。TCP服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个CLOSE-WAIT状态持续的时间。</span></span></li><li id="https://www.notion.so/488bc43c9f0549adb194724a6089f37c" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">客户端收到服务器的确认请求后，此时，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">客户端就进入FIN-WAIT-2（终止等待2）状态，等待服务器发送连接释放报文</strong></span><span class="SemanticString">（在这之前还需要接受服务器发送的最后的数据）。</span></span></li><li id="https://www.notion.so/678c90ef3c814155a75e936b831d99ac" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">服务器将最后的数据发送完毕后，就向客户端发送连接释放报文，FIN=1，ack=u+1，由于在半关闭状态，服务器很可能又发送了一些数据，假定此时的序列号为seq=w，此时，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认</strong></span><span class="SemanticString">。</span></span></li><li id="https://www.notion.so/91fde5c1410c4718a6f8f6279fceca89" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">客户端收到服务器的连接释放报文后，必须发出确认，ACK=1，ack=w+1，而自己的序列号是seq=u+1，此时，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">客户端就进入了TIME-WAIT（时间等待）状态</strong></span><span class="SemanticString">。</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">注意此时TCP连接还没有释放，必须经过2∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才进入CLOSED状态</strong></span><span class="SemanticString">。</span></span></li><li id="https://www.notion.so/ac953e2014c346f0ab3e8dd0fd8b4384" class="NumberedList" value="6"><span class="SemanticStringArray"><span class="SemanticString">服务器只要收到了客户端发出的确认，立即进入CLOSED状态。同样，撤销TCB后，就结束了这次的TCP连接。可以看到，服务器结束TCP连接的时间要比客户端早一些。</span></span></li></ol><div id="https://www.notion.so/48009fd02ba84597964bf810693c66fe" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">MSL是Maximum Segment Lifetime，一个数据分片（报文）在网络中能够生存的最长时间，一个MSL大概2分钟的时间。</span></span></p></div><div id="https://www.notion.so/d326aad476fd41b281301bbb5ebf7ad6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">为什么客户端还需要等待2MSL的时间呢？</strong></span></span></p></div><div id="https://www.notion.so/fdfb828da3dd4880bbbb3364f61da0a7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">第一，保证客户端发送的最后一个ACK报文能够到达服务器，因为这个ACK报文可能丢失，站在服务器的角度看来，我已经发送了FIN+ACK报文请求断开了，客户端还没有给我回应，应该是我发送的请求断开报文它没有收到，于是服务器又会重新发送一次，而客户端就能在这个2MSL时间段内收到这个重传的报文，接着给出回应报文，并且会重启2MSL计时器。</span></span></p></div><div id="https://www.notion.so/3ce99f68c16f437d9a49d23891c2dbb4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">第二，防止类似与“三次握手”中提到了的“已经失效的连接请求报文段”出现在本连接中。客户端发送完最后一个确认报文后，在这个2MSL时间中，就可以使本连接持续的时间内所产生的所有报文段都从网络中消失。这样新的连接中不会出现旧连接的请求报文。</span></span></p></div><h2 id="https://www.notion.so/8c6e2c25b8ea4989919873b0b71d8862" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/8c6e2c25b8ea4989919873b0b71d8862"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">从socket的角度看TCP/IP的工作</span></span></h2><div id="https://www.notion.so/ef92d4961ccf4337aca8c629f9bf1064" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">终于到了最后的部分，我们TCP/IP协议的工作是离不开socket的，之前提到的半连接、全连接也是和socket有关的状态。</span></span></p></div><div id="https://www.notion.so/f24d44b7d4604f9892da21d99044c2d8" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F892482c9-6a63-4311-ad3b-52086bcbe148%2FUntitled.png?width=1244&amp;table=block&amp;id=f24d44b7-d460-4f98-92da-21d99044c2d8"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F892482c9-6a63-4311-ad3b-52086bcbe148%2FUntitled.png?width=1244&amp;table=block&amp;id=f24d44b7-d460-4f98-92da-21d99044c2d8" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/a3dd4376ce084c0b8d5c184c498ed52f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">回过头来看这张图，当我们申请进行TCP通信的时候，实际上背后的工作者是socket</span></span></p></div><div id="https://www.notion.so/1cbb0ba1d11e4014a71c642df5ed4662" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们一个tcp连接标识为</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">&lt;clientIP, clientPort, serverIP, serverPort&gt;</code></span></span></p></div><div id="https://www.notion.so/98034b3177bb42628860822922f6944b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">其中socket就是用来监听端口号和通信的。</span></span></p></div><h3 id="https://www.notion.so/275732cf83aa47cc86d1b13d057e2bc7" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/275732cf83aa47cc86d1b13d057e2bc7"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">客户端的socket</span></span></h3><div id="https://www.notion.so/e6cf1e48d5cd4fd6bb02fa59b7856c13" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F52ea3a1c-3cd0-4f7d-ad63-9a2ac358b212%2FUntitled.png?width=1121&amp;table=block&amp;id=e6cf1e48-d5cd-4fd6-bb02-fa59b7856c13"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F52ea3a1c-3cd0-4f7d-ad63-9a2ac358b212%2FUntitled.png?width=1121&amp;table=block&amp;id=e6cf1e48-d5cd-4fd6-bb02-fa59b7856c13" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/fa415e64d4b84f9d80a224e6ca70719f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">首先客户端通过</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">socket</code></span><span class="SemanticString">函数创建一个socket，这个socket会随机分配一个端口号</span></span></p></div><div id="https://www.notion.so/78484634bfbe4a0e873a4ce6fc015e6c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">然后使用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">connect</code></span><span class="SemanticString">去连接web服务器，这里需要的参数是&lt;serverIp, serverPort&gt;，默认的HTTP端口号是80，而IP是我们从DNS服务器里面获取的</span></span></p></div><div id="https://www.notion.so/dcee5b0d067949639e20b102844143af" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">如果建立完毕，那么就可以开始传输了</span></span></p></div><div id="https://www.notion.so/a3944ba1fc9e438c8ea56f1c8646effc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">使用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">write</code></span><span class="SemanticString">写入数据，使用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">read</code></span><span class="SemanticString">读取数据</span></span></p></div><div id="https://www.notion.so/b805493089204b53ab9886aa677de865" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">最后关闭连接时使用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">close</code></span><span class="SemanticString">断开</span></span></p></div><h3 id="https://www.notion.so/896834d3237045f58dead80d39f6a959" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/896834d3237045f58dead80d39f6a959"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">服务端的socket</span></span></h3><div id="https://www.notion.so/2b95ef890c9643f18b0bc4ee50d1db7d" class="Embed"><div class="Embed__Content"><div class="Embed__ResponsiveContainer" style="width:1341px;padding-bottom:99.25428784489188%"><iframe src="#" sandbox="allow-scripts allow-popups allow-forms allow-same-origin" allowfullscreen=""></iframe></div></div></div><div id="https://www.notion.so/b22a90f34089491791666c9b054817f2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">服务端的socket稍微有点不同</span></span></p></div><div id="https://www.notion.so/b346ca9e7d314388b10f46677ef48fde" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">首先socket分为监听socket和连接socket，我们大家都知道socket是用来监听端口的。</span></span></p></div><div id="https://www.notion.so/89bf411b54f24d2d8500f31087d4471c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">比如说我们创建一个web服务，监听8080端口，那么此时web服务器是创建一个监听socket去监听8080端口</span></span></p></div><div id="https://www.notion.so/ce1f342083c04921afaf1ba9661211ae" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">然后当请求进来的时候，监听socket收到请求申请，那么就会通知CPU，CPU就会分配新的连接socket和缓存（加一起就是TCB）去监听8080端口，真正实际通信的是该连接socket。</span></span></p></div><div id="https://www.notion.so/0eccaab4517b44489c628a35516661df" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这样一个端口是可以被多个socket监听的，它们辨识的方法就是客户端的IP地址和端口号，用这两个信息来区分一个端口号到底是哪个socket来执行通信。</span></span></p></div><div id="https://www.notion.so/4948e14ea3b946b68c16bace70b2009a" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F72351220-0208-4255-9148-08d2bc3af0f9%2FUntitled.png?width=1361&amp;table=block&amp;id=4948e14e-a3b9-46b6-8c16-bace70b2009a"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F72351220-0208-4255-9148-08d2bc3af0f9%2FUntitled.png?width=1361&amp;table=block&amp;id=4948e14e-a3b9-46b6-8c16-bace70b2009a" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/43dd6e0bbec64d7baca92ca2d16cf8f0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">明白了上述概念，我们再来看服务器端的socket如何操作。</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/e54f1f395ed349c597fe11114f7a1fc8" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">首先通过</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">socket</code></span><span class="SemanticString">来创建一个socket</span></span></li><li id="https://www.notion.so/3487a855e4bb44d2b200d58d63cc7a47" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">通过</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">bind</code></span><span class="SemanticString">来绑定指定端口</span></span></li><li id="https://www.notion.so/8cce4901749c40e0bffedb6f4a179fa2" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">使用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">listent</code></span><span class="SemanticString">来将socket转换为监听socket</span></span></li><li id="https://www.notion.so/99464ff3892e48dc8668dee9d8f588af" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">调用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">accpect</code></span><span class="SemanticString">等待客户端发起连接请求，此时获得的描述符2是连接socket，我们交给通信模块处理</span></span></li><li id="https://www.notion.so/882407c7206d489fb9bad6de775238bf" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">使用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">write</code></span><span class="SemanticString">和</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">read</code></span><span class="SemanticString">来通信</span></span></li><li id="https://www.notion.so/128b19b92c2e4cc0bdaa5016cbfb9096" class="NumberedList" value="6"><span class="SemanticStringArray"><span class="SemanticString">使用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">close</code></span><span class="SemanticString">来结束通信</span></span></li></ol><h3 id="https://www.notion.so/95420222a9434d95b6af7d8d41521751" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/95420222a9434d95b6af7d8d41521751"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">三次握手中的socket</span></span></h3><div id="https://www.notion.so/b46800a849284da1a4c222698186fb36" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以下内容参考：</span></span></p></div><div id="https://www.notion.so/948d13a896b84a2f8e62c3dab6c94512" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.cnblogs.com/xiaolincoding/p/12995358.html">TCP 半连接队列和全连接队列满了会发生什么？又该如何应对？ - 小林coding - 博客园 (cnblogs.com)</a></span></span></p></div><div id="https://www.notion.so/37896ba2113a483a8625a8f9a9d30510" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">介绍了socket的基本使用后，我们来看三次握手中的socket和资源分配吧</span></span></p></div><div id="https://www.notion.so/3f2a673632424406849eb3819c673a6c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F619eb563-0c97-4627-a1f5-2a3b3f93560a%2FUntitled.png?width=1082&amp;table=block&amp;id=3f2a6736-3242-4406-849e-b3819c673a6c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F619eb563-0c97-4627-a1f5-2a3b3f93560a%2FUntitled.png?width=1082&amp;table=block&amp;id=3f2a6736-3242-4406-849e-b3819c673a6c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/2d709c32acb243a0889692d82330ddaf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">半连接队列与全连接队列</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/24ffe23bfc6547adb90b2998d5611832" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">首先服务端进行</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">bind</code></span><span class="SemanticString">和</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">listen</code></span><span class="SemanticString">调用，创建监听socket</span></span></li><li id="https://www.notion.so/931ead564734417b9b3338a2d86659ff" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">然后客户端创建socket后，执行</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">connect</code></span><span class="SemanticString">建立连接，发送SYN=1的数据包</span></span></li><li id="https://www.notion.so/12ccc3744ca74eeaa0bc7e3bdb50c3d3" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">服务器收到SYN=1的数据包后，会将该连接加入到半连接队列（SYN队列），然会返回SYN+ACK给客户端</span></span></li><li id="https://www.notion.so/215a2a420f6d4daba7d5f6ae447242b0" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">当服务器再次收到ACK的时候，会把连接从半连接队列里面取出来，加入到全连接队列</span></span></li><li id="https://www.notion.so/d402cf3814a04c1e9a26c3ecb69917e1" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">然后服务器调用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">accept</code></span><span class="SemanticString">可以从全连接队列中取出连接进行处理</span></span></li></ol><div id="https://www.notion.so/d7c0c15be8914ef8aa45f24898c912df" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff0af41f8-665c-4e76-9d19-965d83e7d17c%2FUntitled.png?width=737&amp;table=block&amp;id=d7c0c15b-e891-4ef8-aa45-f24898c912df"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff0af41f8-665c-4e76-9d19-965d83e7d17c%2FUntitled.png?width=737&amp;table=block&amp;id=d7c0c15b-e891-4ef8-aa45-f24898c912df" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h2 id="https://www.notion.so/f4b9f2c93b49453eb6998574fa8fc316" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f4b9f2c93b49453eb6998574fa8fc316"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">总结</span></span></h2><div id="https://www.notion.so/a441631b45194eb7b331a2c3c2052f5b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">本文简单的回答了浏览器输入URL到返回数据到底发生了什么这个问题.</span></span></p></div><div id="https://www.notion.so/7dcc40905dff436bada2e360e4c561d3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">中间涉及到TCP/IP的通信过程和socket等内容。</span></span></p></div><h2 id="https://www.notion.so/f5dae123d44b423c9bb776c45fc61cc3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f5dae123d44b423c9bb776c45fc61cc3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">参考</span></span></h2><div id="https://www.notion.so/69b23b2b40d64ef58f00b70a472dc1fc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://blog.csdn.net/qzcsu/article/details/72861891">两张动图-彻底明白TCP的三次握手与四次挥手</a></span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://blog.csdn.net/qzcsu/article/details/72861891"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">小书go的博客-CSDN博客</em></a></span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://blog.csdn.net/qzcsu/article/details/72861891">三次握手四次挥手详解</a></span></span></p></div><div id="https://www.notion.so/f374026311a84af2aa488daade620188" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://blog.51cto.com/u_14888059/3790731?b=totalstatistic">你知道跟 TCP三次握手息息相关的半连接队列和全连接队列吗？</a></span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://blog.51cto.com/u_14888059/3790731?b=totalstatistic"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">小林coding的技术博客</em></a></span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://blog.51cto.com/u_14888059/3790731?b=totalstatistic">51CTO博客</a></span></span></p></div><div id="https://www.notion.so/8cc907e1b43b4662a4f95db76e7a51e1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://blog.51cto.com/byygyy/3912257">TCP长连接与短连接、心跳机制</a></span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://blog.51cto.com/byygyy/3912257"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">李欢欢的技术博客</em></a></span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://blog.51cto.com/byygyy/3912257">51CTO博客</a></span></span></p></div><div id="https://www.notion.so/48e039d73ea44fe88ed487e3c431167b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.jianshu.com/p/4138fc17b126">详解TCP协议，TCB，TCP的三次握手、四次挥手 - 简书 (jianshu.com)</a></span></span></p></div><div id="https://www.notion.so/a8c89dc54cfd4c4990303db417ae9d41" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></article>
  <footer class="Footer">
  <div>&copy; Notablog 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>