<!DOCTYPE html><html lang="zh-CN"><head><meta name="viewport" content="width=device-width"/><title>Go 并发编程 - Mutex 注意事项</title><meta name="robots" content="follow, index"/><meta charSet="UTF-8"/><meta name="keywords" content="Blog, Notion, Tech, Python, Django"/><meta name="description" content="同步原语使用注意事项"/><meta property="og:locale" content="zh-CN"/><meta property="og:title" content="Go 并发编程 - Mutex 注意事项"/><meta property="og:description" content="同步原语使用注意事项"/><meta property="og:url" content="https://hhmy27.github.io/"/><meta property="og:image" content="https://og-image-craigary.vercel.app/Go%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%20-%20Mutex%20%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:description" content="同步原语使用注意事项"/><meta name="twitter:title" content="Go 并发编程 - Mutex 注意事项"/><meta name="twitter:image" content="https://og-image-craigary.vercel.app/Go%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%20-%20Mutex%20%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9.png?theme=dark&amp;md=1&amp;fontSize=125px&amp;images=https%3A%2F%2Fnobelium.vercel.app%2Flogo-for-dark-bg.svg"/><meta property="article:published_time"/><meta property="article:author" content="hhmy"/><meta name="next-head-count" content="18"/><link rel="preload" href="/fonts/IBMPlexSansVar-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/fonts/IBMPlexSansVar-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="preload" as="style" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/><noscript><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap"/></noscript><link rel="icon" href="/favicon.svg" type="image/svg+xml"/><link rel="icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="192x192" href="/apple-touch-icon.png"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/feed"/><meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)"/><meta name="theme-color" content="#18181B" media="(prefers-color-scheme: dark)"/><link rel="preload" href="/_next/static/css/8e8bd7c50b2739f5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e8bd7c50b2739f5.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6a5815369e10547f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6a5815369e10547f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-c0a56147c8fcef8f.js" defer=""></script><script src="/_next/static/chunks/main-e557dee8cfeafd6c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d2e3d73b18ace6cc.js" defer=""></script><script src="/_next/static/chunks/b5f2ed29-08db60af0c3043ba.js" defer=""></script><script src="/_next/static/chunks/684-63c1a25e215d8bed.js" defer=""></script><script src="/_next/static/chunks/580-c0214944b9e37cce.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-4ebe365aff0c04b1.js" defer=""></script><script src="/_next/static/GXnb-enYBcXKcqOfCSiWO/_buildManifest.js" defer=""></script><script src="/_next/static/GXnb-enYBcXKcqOfCSiWO/_ssgManifest.js" defer=""></script><script src="/_next/static/GXnb-enYBcXKcqOfCSiWO/_middlewareManifest.js" defer=""></script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"/></head><body class="bg-day dark:bg-night"><div id="__next" data-reactroot=""><div><div class="wrapper font-sans"><div class="observer-element h-4 md:h-12"></div><div class="sticky-nav m-auto w-full h-6 flex flex-row justify-between items-center mb-2 md:mb-12 py-8 bg-opacity-60 max-w-3xl px-4" id="sticky-nav"><div class="flex items-center"><a aria-label="hhmy 的博客" href="/"><div class="h-6"><svg width="27" height="27" viewBox="0 0 27 27" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="27" height="27" class="fill-current text-black dark:text-white"></rect><rect width="27" height="27" fill="url(#paint0_radial)"></rect><defs><radialGradient id="paint0_radial" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="rotate(45) scale(39.598)"><stop stop-color="#3399FF" stop-opacity="0.9"></stop><stop offset="1" stop-color="#E0E0E0" stop-opacity="0.3"></stop></radialGradient></defs></svg></div></a><p class="ml-2 font-medium text-day dark:text-night header-name">Go 并发编程 - Mutex 注意事项</p></div><div class="flex-shrink-0"><ul class="flex flex-row"><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/about">关于</a></li><li class="block ml-4 text-black dark:text-gray-50 nav"><a href="/search">搜索</a></li></ul></div></div><main class="m-auto flex-grow w-full transition-all max-w-3xl px-4"><article><h1 class="font-bold text-3xl text-black dark:text-white"> <!-- -->Go 并发编程 - Mutex 注意事项</h1><nav class="flex mt-7 items-start text-gray-500 dark:text-gray-400"><div class="flex mb-4"><a href="https://github.com/hhmy27" class="flex"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2724%27%20height=%2724%27/%3e"/></span><img alt="hhmy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="hhmy" srcSet="https://gravatar.com/avatar/c8089598dc27a7944c95a8ed30867b78?imwidth=32 1x, https://gravatar.com/avatar/c8089598dc27a7944c95a8ed30867b78?imwidth=48 2x" src="https://gravatar.com/avatar/c8089598dc27a7944c95a8ed30867b78?imwidth=48" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full" loading="lazy"/></noscript></span><p class="ml-2 md:block">hhmy</p></a><span class="block"> / </span></div><div class="mr-2 mb-4 md:ml-0">2022 年 12 月 28 日</div><div class="flex flex-nowrap max-w-full overflow-x-auto article-tags"><a href="/tag/Go"><p class="mr-1 rounded-full px-2 py-1 border leading-none text-sm dark:border-gray-600">Go</p></a></div></nav><div class="-mt-4"><main class="notion light-mode notion-page notion-block-918008b0231b4552b752e1f3dc35cbfc"><div class="notion-viewport"></div><div class="notion-collection-row"><div class="notion-collection-row-body"><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M10.889 5.5H3.11v1.556h7.778V5.5zm1.555-4.444h-.777V0H10.11v1.056H3.89V0H2.333v1.056h-.777c-.864 0-1.548.7-1.548 1.555L0 12.5c0 .856.692 1.5 1.556 1.5h10.888C13.3 14 14 13.356 14 12.5V2.611c0-.855-.7-1.555-1.556-1.555zm0 11.444H1.556V3.944h10.888V12.5zM8.556 8.611H3.11v1.556h5.445V8.61z"></path></svg><div class="notion-collection-column-title-body">date</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-date">Dec 28, 2022</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">slug</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text">use-mutex</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">status</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"><div class="notion-property-select-item notion-item-red">Published</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M4 3a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zM2 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2z"></path></svg><div class="notion-collection-column-title-body">tags</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-multi_select"><div class="notion-property-multi_select-item notion-item-default">Go</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">summary</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text">同步原语使用注意事项</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">type</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"><div class="notion-property-select-item notion-item-purple">Post</div></span></div></div></div></div><div class="notion-table-of-contents notion-gray notion-block-c039c9e86673407d81992721d3516ab4"><a href="#585955a5c5ff4369b30f137066398ff0" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">简介</span></a><a href="#c12b3f313e28483aaa85849c41f676ca" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">Lock 和 Unlock 没有匹配</span></a><a href="#3be64419d413466788760523afc0c99b" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">不可复制</span></a><a href="#e7866a55d7994fc9bdc3c8757eb9970b" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">不可重入</span></a><a href="#e1f145fcaf8c4dbba8431be6df58a1d0" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">死锁</span></a><a href="#48881f4313484a52b88b2428f2288e24" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">扩展</span></a><a href="#9117d7eb585845baae37dcf036af6147" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">Go 的死锁检查机制</span></a><a href="#d6c59017233641b6abf42c20455055b5" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">Ref</span></a></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-585955a5c5ff4369b30f137066398ff0" data-id="585955a5c5ff4369b30f137066398ff0"><span><div id="585955a5c5ff4369b30f137066398ff0" class="notion-header-anchor"></div><a class="notion-hash-link" href="#585955a5c5ff4369b30f137066398ff0" title="简介"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">简介</span></span></h2><div class="notion-text notion-block-6fa2786768444096a9c6e424281e0b1b">使用 Mutex 需要注意四个可能踩坑的地方：</div><ol start="1" class="notion-list notion-list-numbered notion-block-7ebc3bc68efb45bf9ad6a09693cc39b1"><li>Lock 和 Unlock 没有匹配</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-edd7e4bbdf0d4cebbd17695af3127cee"><li>不可复制</li></ol><ol start="3" class="notion-list notion-list-numbered notion-block-4c65e82f1bdd40749cc2d2edc76f508c"><li>不可重入</li></ol><ol start="4" class="notion-list notion-list-numbered notion-block-5eeeac8554dd4659bf00b5f797f108ff"><li>死锁</li></ol><div class="notion-blank notion-block-112bab1ad6b3446e983d06cefb618735"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-c12b3f313e28483aaa85849c41f676ca" data-id="c12b3f313e28483aaa85849c41f676ca"><span><div id="c12b3f313e28483aaa85849c41f676ca" class="notion-header-anchor"></div><a class="notion-hash-link" href="#c12b3f313e28483aaa85849c41f676ca" title="Lock 和 Unlock 没有匹配"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Lock 和 Unlock 没有匹配</span></span></h2><div class="notion-text notion-block-969e43e12a354d4aaec252ba5c6fc9d2">没有匹配指的是 Lock 和 Unlock 不一致</div><div class="notion-text notion-block-3d495baf062247b1a9de13a45894eefb">比如说 Lock 之后没有及时的调用 Unlock，导致锁一直被持有，最终死锁 panic。</div><div class="notion-text notion-block-9fcfe44188494323928ad89242b4bb30">或者没有 Lock 之前就调用了 Unlock，这样会触发 fatal error，recover 也无能为力。</div><div class="notion-text notion-block-beb69999565040f59a02fa5905c1dd1d">听起来是很低级的失误，但是在实际开发过程中，可能出现的场景却有很多</div><ol start="1" class="notion-list notion-list-numbered notion-block-1c0793ce41894e6ba3e4685b7b42e3e3"><li>多层 if-else 的复杂嵌套，导致没有在对应的逻辑分支中释放锁</li><ol class="notion-list notion-list-numbered notion-block-1c0793ce41894e6ba3e4685b7b42e3e3"><blockquote class="notion-quote notion-block-bb1618ca7ecf4ad29644908447cb0151">尽量避免超过 3 层以上的嵌套缩进，如果超过了 3 层，或许应该考虑重构这段逻辑
<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://www.bilibili.com/video/BV1q14y1K7p3/?spm_id_from=333.337.search-card.all.click&amp;vd_source=6fdf39f6cb0f5cc47230ec74d156d0a4">为什么你不应该嵌套代码，Linux之父也在这样做_哔哩哔哩_bilibili</a></blockquote><div class="notion-text notion-block-171daff389764f80b784cdd5118e8321">举一个例子</div><pre class="notion-code language-go"><code class="language-go"> <span class="token keyword">if</span> check <span class="token punctuation">{</span>
		mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> check <span class="token punctuation">{</span>
			<span class="token comment">// do something ...</span>
			mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// do something ...</span>
			<span class="token comment">// doesn't release lock</span>
			<span class="token keyword">return</span> 
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span></code></pre><div class="notion-text notion-block-a54bee4afccd49df8930c969ffdfdc91">上面这段代码在 else 的时候忘记释放锁，直接 return，这种情况下会直接导致死锁。</div></ol></ol><ol start="2" class="notion-list notion-list-numbered notion-block-7946549192f94a929a003155dd4c7c1b"><li>重构代码的时候错误的删除了 Unlock</li><ol class="notion-list notion-list-numbered notion-block-7946549192f94a929a003155dd4c7c1b"><div class="notion-text notion-block-725bad6fadd54258ac82429c8e529839">由于不熟悉上下文，在我们进行复杂的逻辑改动的时候，很有可能会不小心删除掉 Unlock 相关的代码，比如说重构上面复杂的 if-else，我们可能尝试删减或添加一个分支的时候，把原有的 Unlock 给去掉了，导致死锁</div><div class="notion-text notion-block-c77e76afe597460d9b953f6c4ee12f05">再举一个例子</div><pre class="notion-code language-go"><code class="language-go">mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 新增的 if 逻辑，直接返回并没有释放</span>
<span class="token keyword">if</span> check <span class="token punctuation">{</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></ol></ol><ol start="3" class="notion-list notion-list-numbered notion-block-fa0f69c0a7044595a589ffd8bb50b4ee"><li>没有触发 Unlock 的调用逻辑</li><ol class="notion-list notion-list-numbered notion-block-fa0f69c0a7044595a589ffd8bb50b4ee"><div></div><div class="notion-text notion-block-b699c42e7a86453abd0061cc97364c6d">原始代码逻辑是在 845 行进行加锁，在接下来的子函数中进行处理，并负责解锁</div><div class="notion-text notion-block-047040421bdb497d84e83ed4a5bf25d5">但是这里有一个弊端，就是子函数如果出现 panic，会直接触发 recover 的逻辑，但是旧的 recover 并没有做锁的释放，那么就会出现死锁了。所以这个 MR 也是修复了这个问题，如果出现了 panic，在 recover 的时候同时释放锁，避免死锁出现。</div><blockquote class="notion-quote notion-block-008420c4b2c645b4b0638aac41b91255">虽然理想状态下是平级做 Lock/Unlock 的，但是工程规模一旦扩大，就很难达到这种理想的重构，所以只能用这种折中的办法修复问题，虽然不是很优雅，但是能解决问题。</blockquote><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-dea6283ca92142b99a5b3201fc5a0b40"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Ffile.notion.so%2Ff%2Fs%2F9d67aea7-037f-4406-99eb-4611df9c24a3%2FUntitled.png%3Fid%3Ddea6283c-a921-42b9-9a5b-3201fc5a0b40%26table%3Dblock%26spaceId%3De7bb21a8-53c5-4141-a2a6-9c3a436ecfe4%26expirationTimestamp%3D1693584000000%26signature%3DbLobBdncI2Z8H_dssX_1dIGukMU4abCG2SwjSXT7rqg?table=block&amp;id=dea6283c-a921-42b9-9a5b-3201fc5a0b40&amp;cache=v2" loading="lazy" alt="notion image" decoding="async"/></div></figure></ol></ol><ol start="4" class="notion-list notion-list-numbered notion-block-5c452d84c9ed4011a488c7f8dc07aea2"><li>加锁之前解锁</li><ol class="notion-list notion-list-numbered notion-block-5c452d84c9ed4011a488c7f8dc07aea2"><pre class="notion-code language-go"><code class="language-go"><span class="token literal-property property">mu</span> <span class="token operator">:</span><span class="token operator">=</span> sync<span class="token punctuation">.</span>Mutex<span class="token punctuation">{</span><span class="token punctuation">}</span>
mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="notion-text notion-block-9f9de483a2c54075b2099fb8470c72c4">比如说上面这种情况，会报错</div><pre class="notion-code language-go"><code class="language-go">fatal error<span class="token operator">:</span> sync<span class="token operator">:</span> unlock <span class="token keyword">of</span> unlocked mutex</code></pre><div class="notion-text notion-block-bce85baf72b443a79f166a84ae0b4ff4">这个 fatal error 是没办法 recover 的，它不是 panic，出现这种情况只能修改代码了。</div></ol></ol><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-3be64419d413466788760523afc0c99b" data-id="3be64419d413466788760523afc0c99b"><span><div id="3be64419d413466788760523afc0c99b" class="notion-header-anchor"></div><a class="notion-hash-link" href="#3be64419d413466788760523afc0c99b" title="不可复制"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">不可复制</span></span></h2><div class="notion-text notion-block-768e21c93f464e3b945d9e4edef2553d">Mutex 的特性是不可复制的，因为 Mutex 中用 state 记录了当前锁的信息，如 waiter 数量，当前锁的状态等信息。而 Mutex 的状态是瞬息万变的，是多个 goruntine 一起决定的，当我们复制了一个 Mutex，可能会得到处于加锁状态的 Mutex，这个 Mutex 永远也没办法使用了。</div><div class="notion-text notion-block-de03be155bef4a2fb790844e6182338b">看一个例子</div><pre class="notion-code language-go"><code class="language-go">type Counter struct <span class="token punctuation">{</span>
	sync<span class="token punctuation">.</span>Mutex
	Count int
<span class="token punctuation">}</span>

func <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> c Counter
	c<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	defer c<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	c<span class="token punctuation">.</span>Count<span class="token operator">++</span>
	<span class="token function">foo</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 无意间复制了 Mutex</span>
func <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">c Counter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	defer c<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"in foo"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><div class="notion-text notion-block-26eac19bc09e4a06b2e9187093741047">在函数传递的无意间复制了 Counter 中的 Mutex，这里运行会直接报错<code class="notion-inline-code">fatal error: all goroutines are asleep - deadlock!</code></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-e7866a55d7994fc9bdc3c8757eb9970b" data-id="e7866a55d7994fc9bdc3c8757eb9970b"><span><div id="e7866a55d7994fc9bdc3c8757eb9970b" class="notion-header-anchor"></div><a class="notion-hash-link" href="#e7866a55d7994fc9bdc3c8757eb9970b" title="不可重入"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">不可重入</span></span></h2><div class="notion-text notion-block-8ac753931bfd4a59b12f8f171c9ef5f6">锁的可重入特性指的是锁的持有者可以反复获取锁。java 中的 ReentrantLock 就是可重入锁。通过记录锁的持有者和重入次数来进行加锁和解锁。</div><div class="notion-text notion-block-f373c8bfce344460b30e2feb9dff8881">Go 的 Mutex 不支持可重入，所以连续调用 Lock 也会导致 fatal error。</div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-e1f145fcaf8c4dbba8431be6df58a1d0" data-id="e1f145fcaf8c4dbba8431be6df58a1d0"><span><div id="e1f145fcaf8c4dbba8431be6df58a1d0" class="notion-header-anchor"></div><a class="notion-hash-link" href="#e1f145fcaf8c4dbba8431be6df58a1d0" title="死锁"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">死锁</span></span></h2><div class="notion-text notion-block-db2bfd1311ce428681deabb567f996bd">这几乎是最常见的问题了。</div><div class="notion-text notion-block-6e6c0f662bea40fb9b04e35fed2b3ba3">我们先回忆一下死锁产生的必要条件</div><ol start="1" class="notion-list notion-list-numbered notion-block-c07e5d2b91804001a2b444b5ea8d52bc"><li>互斥：竞争的资源具有排他性，不能同时被多个线程占有。</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-c8fe6510e1bf4f9caafc401a18b7c8bb"><li>请求并保持：每个线程保持了一定的资源，同时还申请新的资源。</li></ol><ol start="3" class="notion-list notion-list-numbered notion-block-0006ae968f1747cf849f8939e398799e"><li>不可剥夺：一旦资源分配给线程，就无法从它手中剥夺资源。</li></ol><ol start="4" class="notion-list notion-list-numbered notion-block-5e6e9fce00f24b6c94f01ba4d555683b"><li>循环等待：多个线程处于循环等待状态，都在等待对方释放资源。</li></ol><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-48881f4313484a52b88b2428f2288e24" data-id="48881f4313484a52b88b2428f2288e24"><span><div id="48881f4313484a52b88b2428f2288e24" class="notion-header-anchor"></div><a class="notion-hash-link" href="#48881f4313484a52b88b2428f2288e24" title="扩展"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">扩展</span></span></h2><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-9117d7eb585845baae37dcf036af6147" data-id="9117d7eb585845baae37dcf036af6147"><span><div id="9117d7eb585845baae37dcf036af6147" class="notion-header-anchor"></div><a class="notion-hash-link" href="#9117d7eb585845baae37dcf036af6147" title="Go 的死锁检查机制"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Go 的死锁检查机制</span></span></h3><div class="notion-text notion-block-fd56543705644a51a63595b194257bd6">Go 能够在运行时检查出死锁问题，能够打印出堆栈信息</div><div class="notion-text notion-block-3d0925ab55044b00bf41fb38d9281d0d">如果我们想要在运行之前检测有没有死锁问题，可以使用 <b>vet </b>这个工具</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-a17aff7a2aec43b0a804f91ca7482449"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:contain" src="https://www.notion.so/image/https%3A%2F%2Ffile.notion.so%2Ff%2Fs%2Fb975d0a4-698e-4dda-b9ce-9b68948a8ec6%2FUntitled.png%3Fid%3Da17aff7a-2aec-43b0-a804-f91ca7482449%26table%3Dblock%26spaceId%3De7bb21a8-53c5-4141-a2a6-9c3a436ecfe4%26expirationTimestamp%3D1693584000000%26signature%3D43tMuIYCKLstkOsgbsZl9ggTmuzk_Bq3TgZmxHndmd0?table=block&amp;id=a17aff7a-2aec-43b0-a804-f91ca7482449&amp;cache=v2" loading="lazy" alt="notion image" decoding="async"/></div></figure><div class="notion-text notion-block-0c22ad80f701449c87a6d1b0b1114b7f">当使用 vet 之后，这个工具可以提示我们潜在的死锁问题，非常智能</div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-d6c59017233641b6abf42c20455055b5" data-id="d6c59017233641b6abf42c20455055b5"><span><div id="d6c59017233641b6abf42c20455055b5" class="notion-header-anchor"></div><a class="notion-hash-link" href="#d6c59017233641b6abf42c20455055b5" title="Ref"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Ref</span></span></h2><div class="notion-text notion-block-beaf21da2d1b4319ad5971fbbb5c7f42"><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://time.geekbang.org/column/intro/100061801">Go 并发编程实战课_Go_并发编程_分布式_同步原语_鸟窝-极客时间 (geekbang.org)</a></div></main></div></article><div class="flex justify-between font-medium text-gray-500 dark:text-gray-400"><a><button class="mt-2 cursor-pointer hover:text-black dark:hover:text-gray-100">← <!-- -->返回</button></a><a><button class="mt-2 cursor-pointer hover:text-black dark:hover:text-gray-100">↑ <!-- -->回到顶部</button></a></div><div></div></main><div class="mt-6 flex-shrink-0 m-auto w-full text-gray-500 dark:text-gray-400 transition-all max-w-3xl px-4"><hr class="border-gray-200 dark:border-gray-600"/><div class="my-4 text-sm leading-6"><div class="flex align-baseline justify-between flex-wrap"><p>© <!-- -->hhmy<!-- --> <!-- -->2019 - 2023</p><p>powered by <a href="https://github.com/craigary/nobelium"><u>nobelium</u></a></p></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"918008b0-231b-4552-b752-e1f3dc35cbfc","date":{"start_date":"2022-12-28"},"type":["Post"],"slug":"use-mutex","tags":["Go"],"summary":"同步原语使用注意事项","title":"Go 并发编程 - Mutex 注意事项","status":["Published"],"createdTime":"Wed Dec 28 2022 08:47:00 GMT+0000 (Coordinated Universal Time)","fullWidth":false,"pageIcon":null,"pageCover":null},"blockMap":{"block":{"918008b0-231b-4552-b752-e1f3dc35cbfc":{"value":{"id":"918008b0-231b-4552-b752-e1f3dc35cbfc","version":406,"type":"page","properties":{"NX\\Q":[["‣",[["d",{"type":"date","start_date":"2022-12-28"}]]]],"`gQ~":[["Post"]],"d]hq":[["use-mutex"]],"sD^m":[["Go"]],"wz|S":[["同步原语使用注意事项"]],"title":[["Go 并发编程 - Mutex 注意事项"]],"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":[["Published"]]},"content":["c039c9e8-6673-407d-8199-2721d3516ab4","585955a5-c5ff-4369-b30f-137066398ff0","6fa27867-6844-4096-a9c6-e424281e0b1b","7ebc3bc6-8efb-45bf-9ad6-a09693cc39b1","edd7e4bb-df0d-4ceb-bd17-695af3127cee","4c65e82f-1bdd-4074-9cc2-d2edc76f508c","5eeeac85-54dd-4659-bf00-b5f797f108ff","112bab1a-d6b3-446e-983d-06cefb618735","c12b3f31-3e28-483a-aa85-849c41f676ca","969e43e1-2a35-4d4a-aec2-52ba5c6fc9d2","3d495baf-0622-47b1-a9de-13a45894eefb","9fcfe441-8849-4323-928a-d89242b4bb30","beb69999-5650-40f5-9a02-fa5905c1dd1d","1c0793ce-4189-4e6b-a3e4-685b7b42e3e3","79465491-92f9-4a92-9a00-3155dd4c7c1b","fa0f69c0-a704-4595-a589-ffd8bb50b4ee","5c452d84-c9ed-4011-a488-c7f8dc07aea2","3be64419-d413-4667-8876-0523afc0c99b","768e21c9-3f46-4e3b-945d-9e4edef2553d","de03be15-5bef-4a2f-b790-844e6182338b","10822e41-fe87-4b9c-bbec-c93e9d84419f","26eac19b-c09e-4a06-b2e9-187093741047","e7866a55-d799-4fc9-bdc3-c8757eb9970b","8ac75393-1bfd-4a59-b12f-8f171c9ef5f6","f373c8bf-ce34-4460-b30e-2feb9dff8881","e1f145fc-af8c-4dbb-a843-1be6df58a1d0","db2bfd13-11ce-4286-81de-abb567f996bd","6e6c0f66-2bea-40fb-9b04-e35fed2b3ba3","c07e5d2b-9180-4001-a2b4-44b5ea8d52bc","c8fe6510-e1bf-4f9c-aafc-401a18b7c8bb","0006ae96-8f17-47cf-849f-8939e398799e","5e6e9fce-00f2-4b6c-94f0-1ba4d555683b","48881f43-1348-4a52-b88b-2428f2288e24","9117d7eb-5858-45ba-ae37-dcf036af6147","fd565437-0564-4a51-a635-95b194257bd6","3d0925ab-5504-4b00-bf41-fb38d9281d0d","a17aff7a-2aec-43b0-a804-f91ca7482449","0c22ad80-f701-449c-87a6-d1b0b1114b7f","d6c59017-2336-41b6-abf4-2c20455055b5","beaf21da-2d1b-4319-ad59-71fbbb5c7f42"],"created_time":1672217220000,"last_edited_time":1672296840000,"parent_id":"a3ce75fe-7085-406b-a33f-74958ef7ee13","parent_table":"collection","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"1d21f050-c8c4-41f3-9fd4-8ff7de49c962":{"value":{"id":"1d21f050-c8c4-41f3-9fd4-8ff7de49c962","version":58,"type":"collection_view_page","view_ids":["876cf270-3f6b-4f1a-b6c8-5ffbd27ca40f"],"collection_id":"a3ce75fe-7085-406b-a33f-74958ef7ee13","format":{"block_locked":false,"block_locked_by":"2c0e0b01-f59e-4e03-b7b6-7d706eecada3","collection_pointer":{"id":"a3ce75fe-7085-406b-a33f-74958ef7ee13","table":"collection","spaceId":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"copied_from_pointer":{"id":"866916e3-b939-468b-9b6f-1d47dce99f9c","table":"block","spaceId":"ac4cb96d-c8f8-4040-9bb2-868d9fc7f526"}},"permissions":[{"role":"editor","type":"user_permission","user_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec"},{"role":"reader","type":"public_permission","added_timestamp":1671187403441}],"created_time":1670483100421,"last_edited_time":1693035413780,"parent_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4","parent_table":"space","alive":true,"copied_from":"866916e3-b939-468b-9b6f-1d47dce99f9c","created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"c039c9e8-6673-407d-8199-2721d3516ab4":{"value":{"id":"c039c9e8-6673-407d-8199-2721d3516ab4","version":4,"type":"table_of_contents","format":{"block_color":"gray"},"created_time":1672295570818,"last_edited_time":1672295520000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"585955a5-c5ff-4369-b30f-137066398ff0":{"value":{"id":"585955a5-c5ff-4369-b30f-137066398ff0","version":20,"type":"header","properties":{"title":[["简介"]]},"created_time":1672217280000,"last_edited_time":1672295580000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"6fa27867-6844-4096-a9c6-e424281e0b1b":{"value":{"id":"6fa27867-6844-4096-a9c6-e424281e0b1b","version":33,"type":"text","properties":{"title":[["使用 Mutex 需要注意四个可能踩坑的地方："]]},"created_time":1672295580000,"last_edited_time":1672295580000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"7ebc3bc6-8efb-45bf-9ad6-a09693cc39b1":{"value":{"id":"7ebc3bc6-8efb-45bf-9ad6-a09693cc39b1","version":86,"type":"numbered_list","properties":{"title":[["Lock 和 Unlock 没有匹配"]]},"created_time":1672236960000,"last_edited_time":1672279980000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"edd7e4bb-df0d-4ceb-bd17-695af3127cee":{"value":{"id":"edd7e4bb-df0d-4ceb-bd17-695af3127cee","version":28,"type":"numbered_list","properties":{"title":[["不可复制"]]},"created_time":1672236960000,"last_edited_time":1672237260000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"4c65e82f-1bdd-4074-9cc2-d2edc76f508c":{"value":{"id":"4c65e82f-1bdd-4074-9cc2-d2edc76f508c","version":24,"type":"numbered_list","properties":{"title":[["不可重入"]]},"created_time":1672236960000,"last_edited_time":1672237260000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"5eeeac85-54dd-4659-bf00-b5f797f108ff":{"value":{"id":"5eeeac85-54dd-4659-bf00-b5f797f108ff","version":51,"type":"numbered_list","properties":{"title":[["死锁"]]},"created_time":1672237020000,"last_edited_time":1672237260000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"112bab1a-d6b3-446e-983d-06cefb618735":{"value":{"id":"112bab1a-d6b3-446e-983d-06cefb618735","version":6,"type":"text","created_time":1672237260000,"last_edited_time":1672237260000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"c12b3f31-3e28-483a-aa85-849c41f676ca":{"value":{"id":"c12b3f31-3e28-483a-aa85-849c41f676ca","version":75,"type":"header","properties":{"title":[["Lock 和 Unlock 没有匹配"]]},"created_time":1672237260000,"last_edited_time":1672279980000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"969e43e1-2a35-4d4a-aec2-52ba5c6fc9d2":{"value":{"id":"969e43e1-2a35-4d4a-aec2-52ba5c6fc9d2","version":101,"type":"text","properties":{"title":[["没有匹配指的是 Lock 和 Unlock 不一致"]]},"created_time":1672279980000,"last_edited_time":1672280040000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"3d495baf-0622-47b1-a9de-13a45894eefb":{"value":{"id":"3d495baf-0622-47b1-a9de-13a45894eefb","version":21,"type":"text","properties":{"title":[["比如说 Lock 之后没有及时的调用 Unlock，导致锁一直被持有，最终死锁 panic。"]]},"created_time":1672280040000,"last_edited_time":1672280040000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"9fcfe441-8849-4323-928a-d89242b4bb30":{"value":{"id":"9fcfe441-8849-4323-928a-d89242b4bb30","version":161,"type":"text","properties":{"title":[["或者没有 Lock 之前就调用了 Unlock，这样会触发 fatal error，recover 也无能为力。"]]},"created_time":1672280040000,"last_edited_time":1672280040000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"beb69999-5650-40f5-9a02-fa5905c1dd1d":{"value":{"id":"beb69999-5650-40f5-9a02-fa5905c1dd1d","version":275,"type":"text","properties":{"title":[["听起来是很低级的失误，但是在实际开发过程中，可能出现的场景却有很多"]]},"created_time":1672237320000,"last_edited_time":1672237500000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"1c0793ce-4189-4e6b-a3e4-685b7b42e3e3":{"value":{"id":"1c0793ce-4189-4e6b-a3e4-685b7b42e3e3","version":251,"type":"numbered_list","properties":{"title":[["多层 if-else 的复杂嵌套，导致没有在对应的逻辑分支中释放锁"]]},"content":["bb1618ca-7ecf-4ad2-9644-908447cb0151","171daff3-8976-4f80-b784-cdd5118e8321","33488662-fee2-4f30-b73d-6bc5d8d2ab23","a54bee4a-fccd-49df-8930-c969ffdfdc91"],"created_time":1672237500000,"last_edited_time":1672238520000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"bb1618ca-7ecf-4ad2-9644-908447cb0151":{"value":{"id":"bb1618ca-7ecf-4ad2-9644-908447cb0151","version":250,"type":"quote","properties":{"title":[["尽量避免超过 3 层以上的嵌套缩进，如果超过了 3 层，或许应该考虑重构这段逻辑\n"],["为什么你不应该嵌套代码，Linux之父也在这样做_哔哩哔哩_bilibili",[["a","https://www.bilibili.com/video/BV1q14y1K7p3/?spm_id_from=333.337.search-card.all.click\u0026vd_source=6fdf39f6cb0f5cc47230ec74d156d0a4"]]]]},"created_time":1672237567416,"last_edited_time":1672237860000,"parent_id":"1c0793ce-4189-4e6b-a3e4-685b7b42e3e3","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"171daff3-8976-4f80-b784-cdd5118e8321":{"value":{"id":"171daff3-8976-4f80-b784-cdd5118e8321","version":26,"type":"text","properties":{"title":[["举一个例子"]]},"created_time":1672237860000,"last_edited_time":1672237860000,"parent_id":"1c0793ce-4189-4e6b-a3e4-685b7b42e3e3","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"33488662-fee2-4f30-b73d-6bc5d8d2ab23":{"value":{"id":"33488662-fee2-4f30-b73d-6bc5d8d2ab23","version":150,"type":"code","properties":{"title":[[" if check {\n\t\tmu.Lock()\n\t\tif check {\n\t\t\t// do something ...\n\t\t\tmu.Unlock()\n\t\t} else {\n\t\t\t// do something ...\n\t\t\t// doesn't release lock\n\t\t\treturn \n\t\t}\n\t}"]],"language":[["Go"]]},"created_time":1672237906368,"last_edited_time":1672238340000,"parent_id":"1c0793ce-4189-4e6b-a3e4-685b7b42e3e3","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"a54bee4a-fccd-49df-8930-c969ffdfdc91":{"value":{"id":"a54bee4a-fccd-49df-8930-c969ffdfdc91","version":312,"type":"text","properties":{"title":[["上面这段代码在 else 的时候忘记释放锁，直接 return，这种情况下会直接导致死锁。"]]},"created_time":1672237500000,"last_edited_time":1672238520000,"parent_id":"1c0793ce-4189-4e6b-a3e4-685b7b42e3e3","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"79465491-92f9-4a92-9a00-3155dd4c7c1b":{"value":{"id":"79465491-92f9-4a92-9a00-3155dd4c7c1b","version":115,"type":"numbered_list","properties":{"title":[["重构代码的时候错误的删除了 Unlock"]]},"content":["725bad6f-add5-4258-ac82-429c8e529839","c77e76af-e597-460d-9b95-3f6c4ee12f05","6147bae6-f36a-4d8e-a2b0-2e6ca79641fd"],"created_time":1672238400000,"last_edited_time":1672238760000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"725bad6f-add5-4258-ac82-429c8e529839":{"value":{"id":"725bad6f-add5-4258-ac82-429c8e529839","version":722,"type":"text","properties":{"title":[["由于不熟悉上下文，在我们进行复杂的逻辑改动的时候，很有可能会不小心删除掉 Unlock 相关的代码，比如说重构上面复杂的 if-else，我们可能尝试删减或添加一个分支的时候，把原有的 Unlock 给去掉了，导致死锁"]]},"created_time":1672238520000,"last_edited_time":1672239000000,"parent_id":"79465491-92f9-4a92-9a00-3155dd4c7c1b","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"c77e76af-e597-460d-9b95-3f6c4ee12f05":{"value":{"id":"c77e76af-e597-460d-9b95-3f6c4ee12f05","version":23,"type":"text","properties":{"title":[["再举一个例子"]]},"created_time":1672238760000,"last_edited_time":1672238760000,"parent_id":"79465491-92f9-4a92-9a00-3155dd4c7c1b","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"6147bae6-f36a-4d8e-a2b0-2e6ca79641fd":{"value":{"id":"6147bae6-f36a-4d8e-a2b0-2e6ca79641fd","version":219,"type":"code","properties":{"title":[["mu.Lock()\n// 新增的 if 逻辑，直接返回并没有释放\nif check {\n\treturn\n}\nmu.Unlock()"]],"language":[["Go"]]},"created_time":1672238776720,"last_edited_time":1672239000000,"parent_id":"79465491-92f9-4a92-9a00-3155dd4c7c1b","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"fa0f69c0-a704-4595-a589-ffd8bb50b4ee":{"value":{"id":"fa0f69c0-a704-4595-a589-ffd8bb50b4ee","version":118,"type":"numbered_list","properties":{"title":[["没有触发 Unlock 的调用逻辑"]]},"content":["a5a29f23-1813-417b-82ec-dca5b4cda87f","b699c42e-7a86-453a-bd00-61cc97364c6d","04704042-1bdb-497d-84e8-3ed4a5bf25d5","008420c4-b2c6-45b4-b063-8aac41b91255","dea6283c-a921-42b9-9a5b-3201fc5a0b40"],"created_time":1672238640000,"last_edited_time":1672289340000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"a5a29f23-1813-417b-82ec-dca5b4cda87f":{"value":{"id":"a5a29f23-1813-417b-82ec-dca5b4cda87f","version":7,"type":"external_object_instance","format":{"stale":false,"domain":"github.com","original_url":"https://github.com/pingcap/tidb/pull/20381/files"},"created_time":1672280100000,"last_edited_time":1672280110738,"parent_id":"fa0f69c0-a704-4595-a589-ffd8bb50b4ee","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"bot","last_edited_by_id":"f5ba3f6b-d493-43ec-afec-91cb48295b50","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"b699c42e-7a86-453a-bd00-61cc97364c6d":{"value":{"id":"b699c42e-7a86-453a-bd00-61cc97364c6d","version":256,"type":"text","properties":{"title":[["原始代码逻辑是在 845 行进行加锁，在接下来的子函数中进行处理，并负责解锁"]]},"created_time":1672280100000,"last_edited_time":1672280400000,"parent_id":"fa0f69c0-a704-4595-a589-ffd8bb50b4ee","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"04704042-1bdb-497d-84e8-3ed4a5bf25d5":{"value":{"id":"04704042-1bdb-497d-84e8-3ed4a5bf25d5","version":709,"type":"text","properties":{"title":[["但是这里有一个弊端，就是子函数如果出现 panic，会直接触发 recover 的逻辑，但是旧的 recover 并没有做锁的释放，那么就会出现死锁了。所以这个 MR 也是修复了这个问题，如果出现了 panic，在 recover 的时候同时释放锁，避免死锁出现。"]]},"created_time":1672280340000,"last_edited_time":1672289340000,"parent_id":"fa0f69c0-a704-4595-a589-ffd8bb50b4ee","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"008420c4-b2c6-45b4-b063-8aac41b91255":{"value":{"id":"008420c4-b2c6-45b4-b063-8aac41b91255","version":6,"type":"quote","properties":{"title":[["虽然理想状态下是平级做 Lock/Unlock 的，但是工程规模一旦扩大，就很难达到这种理想的重构，所以只能用这种折中的办法修复问题，虽然不是很优雅，但是能解决问题。"]]},"created_time":1672289389697,"last_edited_time":1672289340000,"parent_id":"fa0f69c0-a704-4595-a589-ffd8bb50b4ee","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"dea6283c-a921-42b9-9a5b-3201fc5a0b40":{"value":{"id":"dea6283c-a921-42b9-9a5b-3201fc5a0b40","version":10,"type":"image","properties":{"size":[["84.7KB"]],"title":[["Untitled"]],"source":[["https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9d67aea7-037f-4406-99eb-4611df9c24a3/Untitled.png"]]},"format":{"block_width":1306,"display_source":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9d67aea7-037f-4406-99eb-4611df9c24a3/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.3660030627871363,"block_preserve_scale":true},"created_time":1672280280000,"last_edited_time":1672280340000,"parent_id":"fa0f69c0-a704-4595-a589-ffd8bb50b4ee","parent_table":"block","alive":true,"file_ids":["9d67aea7-037f-4406-99eb-4611df9c24a3"],"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"5c452d84-c9ed-4011-a488-c7f8dc07aea2":{"value":{"id":"5c452d84-c9ed-4011-a488-c7f8dc07aea2","version":136,"type":"numbered_list","properties":{"title":[["加锁之前解锁"]]},"content":["f6316445-336d-45f9-929d-5c6d0f32d17f","9f9de483-a2c5-4075-b209-9fb8470c72c4","d369c8b8-8fb8-4d23-b9f0-7d2e424ba747","bce85baf-72b4-43a7-9f16-6a84ae0b4ff4"],"created_time":1672289340000,"last_edited_time":1672294800000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"f6316445-336d-45f9-929d-5c6d0f32d17f":{"value":{"id":"f6316445-336d-45f9-929d-5c6d0f32d17f","version":8,"type":"code","properties":{"title":[["mu := sync.Mutex{}\nmu.Unlock()"]],"language":[["Go"]]},"format":{"code_wrap":true},"created_time":1672294755467,"last_edited_time":1672294740000,"parent_id":"5c452d84-c9ed-4011-a488-c7f8dc07aea2","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"9f9de483-a2c5-4075-b209-9fb8470c72c4":{"value":{"id":"9f9de483-a2c5-4075-b209-9fb8470c72c4","version":174,"type":"text","properties":{"title":[["比如说上面这种情况，会报错"]]},"created_time":1672294740000,"last_edited_time":1672294740000,"parent_id":"5c452d84-c9ed-4011-a488-c7f8dc07aea2","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"d369c8b8-8fb8-4d23-b9f0-7d2e424ba747":{"value":{"id":"d369c8b8-8fb8-4d23-b9f0-7d2e424ba747","version":6,"type":"code","properties":{"title":[["fatal error: sync: unlock of unlocked mutex"]],"language":[["Go"]]},"created_time":1672294784548,"last_edited_time":1672294740000,"parent_id":"5c452d84-c9ed-4011-a488-c7f8dc07aea2","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"bce85baf-72b4-43a7-9f16-6a84ae0b4ff4":{"value":{"id":"bce85baf-72b4-43a7-9f16-6a84ae0b4ff4","version":196,"type":"text","properties":{"title":[["这个 fatal error 是没办法 recover 的，它不是 panic，出现这种情况只能修改代码了。"]]},"created_time":1672294800000,"last_edited_time":1672294860000,"parent_id":"5c452d84-c9ed-4011-a488-c7f8dc07aea2","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"3be64419-d413-4667-8876-0523afc0c99b":{"value":{"id":"3be64419-d413-4667-8876-0523afc0c99b","version":3,"type":"header","properties":{"title":[["不可复制"]]},"created_time":1672237020000,"last_edited_time":1672294800000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"768e21c9-3f46-4e3b-945d-9e4edef2553d":{"value":{"id":"768e21c9-3f46-4e3b-945d-9e4edef2553d","version":516,"type":"text","properties":{"title":[["Mutex 的特性是不可复制的，因为 Mutex 中用 state 记录了当前锁的信息，如 waiter 数量，当前锁的状态等信息。而 Mutex 的状态是瞬息万变的，是多个 goruntine 一起决定的，当我们复制了一个 Mutex，可能会得到处于加锁状态的 Mutex，这个 Mutex 永远也没办法使用了。"]]},"created_time":1672237140000,"last_edited_time":1672295220000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"de03be15-5bef-4a2f-b790-844e6182338b":{"value":{"id":"de03be15-5bef-4a2f-b790-844e6182338b","version":31,"type":"text","properties":{"title":[["看一个例子"]]},"created_time":1672295220000,"last_edited_time":1672295220000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"10822e41-fe87-4b9c-bbec-c93e9d84419f":{"value":{"id":"10822e41-fe87-4b9c-bbec-c93e9d84419f","version":69,"type":"code","properties":{"title":[["type Counter struct {\n\tsync.Mutex\n\tCount int\n}\n\nfunc main() {\n\tvar c Counter\n\tc.Lock()\n\tdefer c.Unlock()\n\tc.Count++\n\tfoo(c)\n}\n\n// 无意间复制了 Mutex\nfunc foo(c Counter) {\n\tc.Lock()\n\tdefer c.Unlock()\n\tfmt.Println(\"in foo\")\n}"]],"language":[["Go"]]},"created_time":1672295244168,"last_edited_time":1672295400000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"26eac19b-c09e-4a06-b2e9-187093741047":{"value":{"id":"26eac19b-c09e-4a06-b2e9-187093741047","version":184,"type":"text","properties":{"title":[["在函数传递的无意间复制了 Counter 中的 Mutex，这里运行会直接报错"],["fatal error: all goroutines are asleep - deadlock!",[["c"]]]]},"created_time":1672295040000,"last_edited_time":1672295520000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"e7866a55-d799-4fc9-bdc3-c8757eb9970b":{"value":{"id":"e7866a55-d799-4fc9-bdc3-c8757eb9970b","version":44,"type":"header","properties":{"title":[["不可重入"]]},"created_time":1672295520000,"last_edited_time":1672295580000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"8ac75393-1bfd-4a59-b12f-8f171c9ef5f6":{"value":{"id":"8ac75393-1bfd-4a59-b12f-8f171c9ef5f6","version":401,"type":"text","properties":{"title":[["锁的可重入特性指的是锁的持有者可以反复获取锁。java 中的 ReentrantLock 就是可重入锁。通过记录锁的持有者和重入次数来进行加锁和解锁。"]]},"created_time":1672295580000,"last_edited_time":1672295820000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"f373c8bf-ce34-4460-b30e-2feb9dff8881":{"value":{"id":"f373c8bf-ce34-4460-b30e-2feb9dff8881","version":182,"type":"text","properties":{"title":[["Go 的 Mutex 不支持可重入，所以连续调用 Lock 也会导致 fatal error。"]]},"created_time":1672295820000,"last_edited_time":1672296060000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"e1f145fc-af8c-4dbb-a843-1be6df58a1d0":{"value":{"id":"e1f145fc-af8c-4dbb-a843-1be6df58a1d0","version":15,"type":"header","properties":{"title":[["死锁"]]},"created_time":1672296060000,"last_edited_time":1672296060000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"db2bfd13-11ce-4286-81de-abb567f996bd":{"value":{"id":"db2bfd13-11ce-4286-81de-abb567f996bd","version":75,"type":"text","properties":{"title":[["这几乎是最常见的问题了。"]]},"created_time":1672296060000,"last_edited_time":1672296060000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"6e6c0f66-2bea-40fb-9b04-e35fed2b3ba3":{"value":{"id":"6e6c0f66-2bea-40fb-9b04-e35fed2b3ba3","version":62,"type":"text","properties":{"title":[["我们先回忆一下死锁产生的必要条件"]]},"created_time":1672296060000,"last_edited_time":1672296060000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"c07e5d2b-9180-4001-a2b4-44b5ea8d52bc":{"value":{"id":"c07e5d2b-9180-4001-a2b4-44b5ea8d52bc","version":156,"type":"numbered_list","properties":{"title":[["互斥：竞争的资源具有排他性，不能同时被多个线程占有。"]]},"created_time":1672296060000,"last_edited_time":1672296180000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"c8fe6510-e1bf-4f9c-aafc-401a18b7c8bb":{"value":{"id":"c8fe6510-e1bf-4f9c-aafc-401a18b7c8bb","version":193,"type":"numbered_list","properties":{"title":[["请求并保持：每个线程保持了一定的资源，同时还申请新的资源。"]]},"created_time":1672296180000,"last_edited_time":1672296180000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"0006ae96-8f17-47cf-849f-8939e398799e":{"value":{"id":"0006ae96-8f17-47cf-849f-8939e398799e","version":153,"type":"numbered_list","properties":{"title":[["不可剥夺：一旦资源分配给线程，就无法从它手中剥夺资源。"]]},"created_time":1672296180000,"last_edited_time":1672296240000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"5e6e9fce-00f2-4b6c-94f0-1ba4d555683b":{"value":{"id":"5e6e9fce-00f2-4b6c-94f0-1ba4d555683b","version":146,"type":"numbered_list","properties":{"title":[["循环等待：多个线程处于循环等待状态，都在等待对方释放资源。"]]},"created_time":1672296240000,"last_edited_time":1672296300000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"48881f43-1348-4a52-b88b-2428f2288e24":{"value":{"id":"48881f43-1348-4a52-b88b-2428f2288e24","version":144,"type":"header","properties":{"title":[["扩展"]]},"created_time":1672296240000,"last_edited_time":1672296300000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"9117d7eb-5858-45ba-ae37-dcf036af6147":{"value":{"id":"9117d7eb-5858-45ba-ae37-dcf036af6147","version":86,"type":"sub_header","properties":{"title":[["Go 的死锁检查机制"]]},"created_time":1672296300000,"last_edited_time":1672296360000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"fd565437-0564-4a51-a635-95b194257bd6":{"value":{"id":"fd565437-0564-4a51-a635-95b194257bd6","version":233,"type":"text","properties":{"title":[["Go 能够在运行时检查出死锁问题，能够打印出堆栈信息"]]},"created_time":1672296360000,"last_edited_time":1672296480000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"3d0925ab-5504-4b00-bf41-fb38d9281d0d":{"value":{"id":"3d0925ab-5504-4b00-bf41-fb38d9281d0d","version":146,"type":"text","properties":{"title":[["如果我们想要在运行之前检测有没有死锁问题，可以使用 "],["vet ",[["b"]]],["这个工具"]]},"created_time":1672296420000,"last_edited_time":1672296480000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"a17aff7a-2aec-43b0-a804-f91ca7482449":{"value":{"id":"a17aff7a-2aec-43b0-a804-f91ca7482449","version":9,"type":"image","properties":{"size":[["53.3KB"]],"title":[["Untitled"]],"source":[["https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b975d0a4-698e-4dda-b9ce-9b68948a8ec6/Untitled.png"]]},"format":{"block_width":1666,"display_source":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b975d0a4-698e-4dda-b9ce-9b68948a8ec6/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.12605042016806722,"block_preserve_scale":true},"created_time":1672296480000,"last_edited_time":1672296480000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"file_ids":["b975d0a4-698e-4dda-b9ce-9b68948a8ec6"],"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"0c22ad80-f701-449c-87a6-d1b0b1114b7f":{"value":{"id":"0c22ad80-f701-449c-87a6-d1b0b1114b7f","version":286,"type":"text","properties":{"title":[["当使用 vet 之后，这个工具可以提示我们潜在的死锁问题，非常智能"]]},"created_time":1672296480000,"last_edited_time":1672296780000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"d6c59017-2336-41b6-abf4-2c20455055b5":{"value":{"id":"d6c59017-2336-41b6-abf4-2c20455055b5","version":12,"type":"header","properties":{"title":[["Ref"]]},"created_time":1672296300000,"last_edited_time":1672296780000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"},"beaf21da-2d1b-4319-ad59-71fbbb5c7f42":{"value":{"id":"beaf21da-2d1b-4319-ad59-71fbbb5c7f42","version":4,"type":"text","properties":{"title":[["Go 并发编程实战课_Go_并发编程_分布式_同步原语_鸟窝-极客时间 (geekbang.org)",[["a","https://time.geekbang.org/column/intro/100061801"]]]]},"created_time":1672296300000,"last_edited_time":1672296780000,"parent_id":"918008b0-231b-4552-b752-e1f3dc35cbfc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","last_edited_by_table":"notion_user","last_edited_by_id":"83b4963a-e71e-4bac-9a62-dabfcb042aec","space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"}},"collection":{"a3ce75fe-7085-406b-a33f-74958ef7ee13":{"value":{"id":"a3ce75fe-7085-406b-a33f-74958ef7ee13","version":21,"name":[["NOBELIUM Template"]],"schema":{"NX\\Q":{"name":"date","type":"date"},"`gQ~":{"name":"type","type":"select","options":[{"id":"5aff2f95-fd1e-489b-8840-bf10bc9519cb","color":"purple","value":"Post"},{"id":"374d2bc6-a144-4832-8ca4-474aaae0ea1f","color":"orange","value":"Page"}]},"d]hq":{"name":"slug","type":"text"},"sD^m":{"name":"tags","type":"multi_select","options":[{"id":"149b2bfe-eff9-4a8e-a509-740376958f01","color":"orange","value":"计算机网络"},{"id":"fbfb28ff-2898-4f5b-a8e9-f18499a0f3da","color":"default","value":"Go"},{"id":"a7a581b6-5d07-466e-b0c8-69b6752bf06e","color":"gray","value":"数据库"},{"id":"7352dc92-14af-4c61-a6e4-1abfed244c4c","color":"purple","value":"算法"},{"id":"a0ac81ef-d914-4f04-b0e4-780ef5b84be4","color":"pink","value":"Vim"}]},"wz|S":{"name":"summary","type":"text"},"title":{"name":"title","type":"title"},"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":{"name":"status","type":"select","options":[{"id":"22460321-fea2-4c7c-b352-a674760780ac","color":"orange","value":"Idea"},{"id":"41d5f5c6-b53c-42bc-8e0f-fc9402048480","color":"yellow","value":"Draft"},{"id":"c7390b31-9fab-4e21-94ee-7e67ea077a97","color":"blue","value":"Revise"},{"id":"7abc61d4-b405-480d-b699-12588755fa65","color":"red","value":"Published"}]}},"icon":"🎟️","format":{"copied_from_pointer":{"id":"dbf0f671-8075-49b9-b238-61e7eb9a7270","table":"collection","spaceId":"ac4cb96d-c8f8-4040-9bb2-868d9fc7f526"},"collection_page_properties":[{"visible":false,"property":"NX\\Q"},{"visible":false,"property":"d]hq"},{"visible":false,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"visible":false,"property":"sD^m"},{"visible":false,"property":"wz|S"},{"visible":false,"property":"`gQ~"}]},"parent_id":"1d21f050-c8c4-41f3-9fd4-8ff7de49c962","parent_table":"block","alive":true,"file_ids":["6cf3dc36-2f98-4f0e-9679-1bdbb1485129","5520bd92-e709-4c0d-ad58-06923f23f7e9","624d393a-62e3-4464-a1bf-1c79ecd4fbda","d52f6766-3e32-4c3d-8529-46e1f214360f"],"copied_from":"dbf0f671-8075-49b9-b238-61e7eb9a7270","migrated":true,"space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"}},"collection_view":{"876cf270-3f6b-4f1a-b6c8-5ffbd27ca40f":{"value":{"id":"876cf270-3f6b-4f1a-b6c8-5ffbd27ca40f","version":32,"type":"table","name":"Default view","format":{"table_wrap":false,"table_properties":[{"width":416,"visible":true,"property":"title"},{"width":186,"visible":true,"property":"d]hq"},{"width":211,"visible":true,"property":"NX\\Q"},{"width":147,"visible":true,"property":"wz|S"},{"width":222,"visible":true,"property":"sD^m"},{"width":124,"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"width":100,"visible":true,"property":"`gQ~"},{"width":200,"visible":true,"property":"gY~W"},{"width":200,"visible":true,"property":"pzWp"},{"visible":true,"property":"B;[p"}]},"parent_id":"1d21f050-c8c4-41f3-9fd4-8ff7de49c962","parent_table":"block","alive":true,"page_sort":["b1e1d645-db95-42e5-8995-39a80eda6460","e8cd3732-dc1c-43ae-959a-a5a611ec098a","e876558d-e878-47f6-8c95-21be678990a5","5a971ded-d3c5-41be-bef9-ddfff48d43a2","8db8b240-e1c5-4dd7-bf74-72584d7a2ce0","daf94ca4-ec56-47a3-84ed-b1e2479acc4b","d1a2db9b-6820-421e-9b80-017ce7478587","67ea9f83-b9f6-416b-afcb-7c64f7533e6c","45939470-9819-47e8-b12b-999cfefa0aad","c60dc33d-8efb-44be-a863-7a87ad047932","fe4b8d5f-7c49-42c6-a7d5-1cb71c4f7e86","b7233a67-c367-4198-831e-f12089568d1f","4f3bf306-92c4-41b7-a43e-957129a1240a","6a789607-66cf-498e-9b32-eb3fa69a84f4","c9429034-dabd-4a25-8782-97f20c808a60","38c49fe2-37f8-4a7f-a99f-9edb9ddad4c2","474eb638-9f6b-46bf-8004-77668293f199","81d6dfab-69cb-43a0-aa04-e9725f0b67e1","7703d956-84db-46cd-b538-48eae1af68b5","9f937c73-dac9-4ed7-9b01-beefcb321f16","3cf9dcb9-e7db-406c-80ab-c65c11fbf906","5827ab53-e051-455b-b90a-3bdc20158c2c","fa7acd3b-dea9-4fb1-b859-5345f35163c6","696dfc48-62c3-494d-96d0-ec5fa84637e8","79df93cf-9b10-452e-bc62-f39e8cd2d124","9bb8e52d-c459-4528-b1b3-c2378207253a","5da038ef-f419-4a11-aa48-587b3787e040","b4a2c9d4-6a2c-49e6-988d-89a538dfe0f6","c374a479-5cc7-4c54-ba69-6a4d76dc25ad","d470fa67-0e7c-40d8-86ac-9b5a8be88dc8","986be38b-9780-4bb9-bdcd-4e361ddbd888","b7613f56-c2d4-4aae-b967-b7471ade86d0","e357d1fc-7466-4d6a-8d48-71b76ea97cdc","e1735855-4089-4af6-bd4d-0d59f7a76cb4","9b34581a-955a-4229-99d0-8f2a6d0e69ce","b4414811-0599-45cf-b047-fa95eac42d89","c28a8a01-911a-40a2-a607-d3af8cb24017","461d07ae-4b4a-49de-bdcb-341af1153201","3df59023-cb68-4a65-afd1-7f0b8c21cb57","0e3223d1-03df-40fb-90f9-cc8559d776b5","4f45b7d6-cd5b-46ab-b2a6-37ae20bf5f21","fa475a21-5f38-43d4-9a89-67c40b3129ae","97cbc634-fe3a-4b9b-9da6-ac4aaa94772f","8a0d34bc-7e8c-4a68-88a5-5276274f612a","623f8788-a20f-45fd-bb82-08935f59b44d","7ee398f0-450b-47cb-9b53-f5e7736590d2","eae9f077-591e-4841-903b-db395513c834","367d0f2a-0b10-4dbb-b53a-613152f124f9","398e2e28-3997-49bc-a138-0467d4da8531","8aaf4633-e879-44dc-82c8-3c9fb9d3a6f8","1eb5e5f2-8dc9-4ffc-b5e1-09b67be27a83","83465fb9-205b-41fc-83a6-424692ee0a0e","fb1d18d0-6403-4e8a-840e-134553748ff5","4407cb77-3838-4ba5-b474-f15222cd3dba","1880b0f2-e036-42d0-9550-0fb08a962397","d8d60bd6-33f6-458f-a7d6-209ef2fb05a1","29bf65ff-888b-4a76-a8dd-bf54f02c3864","bad1d4ae-fd4a-4671-ae94-dd53d94e0eae","0d59792d-db1c-4ae7-8d7c-4f013be40dcf","337dc259-2805-4b1c-a60f-1b3e6c7badb8","4b1b21a8-c278-4bc6-88f1-1a35d407f4d7","7946aba2-d6d0-45ef-8779-23fa15db8f2d","c18dbce6-9e8c-4f4b-b74a-0994e7c1bc3f","84aa87b7-39e7-493c-87b9-5cae4de95449","1446eadb-8c01-4295-be3a-ecf19361c143","fe8a7d94-e9ba-457d-8f19-10fe53e6ca3c","98a5a0b6-b07b-4065-a73f-2949ad28ac47","38e3e030-5423-4343-b944-083b96fd8656","7dc3700b-1183-4e44-b4bb-cb500ae0b363","975051d4-ebbc-4b3f-98cf-1a52e5e4761d","e5d98bee-b2d5-4b45-ab0b-b77da24aebe7","acac2668-1062-4e7a-b095-eda067da8413","179025c4-d8a8-4c47-b621-9fd6a6f3339b","d256e5ed-5eac-43bb-a32e-581774962c23","3531b347-b0c9-406a-97ec-dc1233b52619","3760aeb0-084a-4e6d-88da-54a3c0311402","9c40a253-b9e8-42cd-8a99-62aaa9789a5e","f3c75b97-fd39-40bc-9473-2beb74d837b1","4d9edb9d-6ecd-4f3c-b41a-395987d6a714","c00f43c1-0fd5-45ca-a8af-e65a0bd6c990","9179759d-2b61-41a8-964e-23719e022b2d","19ad7e3a-2736-4d60-9516-6fcda35ed534","fe12b6af-37a2-4eab-a32f-5379fe881886","3634923c-2faf-4a31-a356-6ce9830706fb","6d9c82b0-2b20-425f-a87b-c9b14752bf9d","b57ebe77-5397-4ae8-b342-d19e3554f49c","1009ed18-593a-4ae7-8b32-7c39733138b5","d1d27099-40f0-4c1d-9c3b-a62349291ed2","f3ac9402-f3e4-4dc6-ae57-03d81bfd4e03","c1a9215b-4b3e-4d97-be31-f5d28736a065","8c80a9e1-a9d5-4b96-9a84-26df209c9537","ed91e3f2-5735-4c46-97db-aec5e6c4f597","7364073f-b7c8-436c-a471-779c7775fbf8","0f0ad844-b657-47c1-a04a-61d01ed706c1","6e55a5aa-680a-439d-add1-56498538aa64","7367ec26-da0a-441e-81b4-ae21068b94cf","48636b1e-62eb-449d-80db-68ee12d3caa8","f1c7db1e-871a-4529-9ba8-cd04f43979da","49477ffa-3ecf-49a3-a12d-62bea76192fc","1e50a8aa-3628-4b23-bd39-af65962e7061","fd0f48e9-d102-4502-9d06-94f78405f07a","51e53e64-e6dd-4fd6-8062-5d4455f0a1cb","f4ec684b-e5f1-44e9-a8a7-aca27f7ca6f3","177fa228-9099-4dd5-8969-c67f9c78bd0c","d5ab0d7a-0123-473f-84d4-81740defb9b4","548f6d36-c509-4b79-9c4b-59f227c7f550","c0901673-4f5e-4e51-ad87-0217f2d33a0c","0787f8d6-dc99-47c6-946e-2b008814bebc","0ade5216-1103-486a-aff0-a709ff825b02","a2c4dd21-985c-497d-b421-c2d8a9ec0eeb","908a498c-f7e3-4668-8afd-f179a027b4d9","4945e5c3-033d-467c-a8b3-b1479c1fdf0a","854f4584-28d5-43bd-938e-88d0957c78e3","6a6574f8-d63d-4fed-99c5-38f3df0364ac","baa9bf33-a11f-4da5-80eb-7930448aaad1","586d7983-2a0e-47ee-b80c-2800696255da","553879bb-db6e-448d-8adc-68864d7be6cf","cf1ae05a-dc05-49ed-934b-adf97088cd5c","8cec23d1-4808-4ca8-9562-c98a44fa659c","918008b0-231b-4552-b752-e1f3dc35cbfc","24f98f49-407b-4f0c-b90b-7cb436c0063d","5625b2fb-6c82-4130-b336-0ec9a19d28ef","be5d776a-0cae-4ad0-b823-fc7c1371aca9","951d4753-cc76-4e10-9427-bc1517d34a8c","e7f7db5d-3e80-4afb-a4a8-4863c5302031","14b6937e-c536-48c7-95f8-b71b569ebc4d","ed276d45-3e91-40f4-b3f7-559061948489","0001a0d6-5549-4fc5-955f-57c356d6e87e","31a25d19-9261-43ad-b43e-a31d39f64545","7f5ff12b-b543-473c-9e05-bfba5d7dabff","69fd45e6-5797-4294-8c16-f0ba0a91ad5c","01ffb8be-f877-42b4-ba13-92ad393a7e6c","060867a6-c2c6-4a7c-a282-403e4081d6e4","bc0ea075-4478-4d00-b9d9-1ae358fda6a5","e8704a7f-e816-4458-ae8a-0f9bc9f144b5","bbb78d74-fe80-4da0-9585-a2ef20ab4d1a","e6582267-a054-41b3-80ab-fb860956d3c5","91edf54b-8f96-4f4f-a127-f0b6435a56eb","a2a7b7e4-7286-4510-8576-cc45b70de00a","baeff097-97e3-467f-ba44-32700380ec05","530ff059-bf5c-4dea-9b35-4eb5625f1e2a","ed84e22f-1785-4a57-9c8b-ac92bbe43bc6"],"query2":{"filter":{"operator":"and"},"aggregations":[{"property":"title","aggregator":"count"}]},"space_id":"e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4"},"role":"reader"}},"space":{},"notion_user":{},"collection_query":{},"signed_urls":{"dea6283c-a921-42b9-9a5b-3201fc5a0b40":"https://file.notion.so/f/s/9d67aea7-037f-4406-99eb-4611df9c24a3/Untitled.png?id=dea6283c-a921-42b9-9a5b-3201fc5a0b40\u0026table=block\u0026spaceId=e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4\u0026expirationTimestamp=1693584000000\u0026signature=bLobBdncI2Z8H_dssX_1dIGukMU4abCG2SwjSXT7rqg","a17aff7a-2aec-43b0-a804-f91ca7482449":"https://file.notion.so/f/s/b975d0a4-698e-4dda-b9ce-9b68948a8ec6/Untitled.png?id=a17aff7a-2aec-43b0-a804-f91ca7482449\u0026table=block\u0026spaceId=e7bb21a8-53c5-4141-a2a6-9c3a436ecfe4\u0026expirationTimestamp=1693584000000\u0026signature=43tMuIYCKLstkOsgbsZl9ggTmuzk_Bq3TgZmxHndmd0"}},"emailHash":"c8089598dc27a7944c95a8ed30867b78"},"__N_SSG":true},"page":"/[slug]","query":{"slug":"use-mutex"},"buildId":"GXnb-enYBcXKcqOfCSiWO","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>