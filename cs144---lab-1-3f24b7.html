<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📖&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>CS144 - lab 1&nbsp;|&nbsp;Notablog</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="CS144 - lab 1">
  
    <meta name="description" content="滑动窗口，StreamReassembler">
    <meta property="og:description" content="滑动窗口，StreamReassembler">
  
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📖&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😀&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>关于我</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
    <h1 class="Header__Title">CS144 - lab 1</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Tue, Nov 29, 2022</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--purple">
            <a href="tag/计算机网络.html">计算机网络</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--gray">
            <a href="tag/CS144.html">CS144</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/3f24b7e1048d4c6d85f833ea4befc404" class="PageRoot"><ul id="https://www.notion.so/3fa8b957ce3845afb8db5717cbe308a3" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/9f8a2e02178c462b937369990d5e6dd5"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">简介</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/863effd6d71e4a769b69341a175799b6"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">2 Getting started</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/ba42584f24514f81b47d637cf8b2fbfd"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">3 Putting substrings in sequence</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4cfdcc8725b14a77a223d18dbe2b2f03"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">3.1 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">What’s the “capacity”?</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/93408011d4cc489c882ba855035f253a"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">分析和设计</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/0d180ebc6c1e401ab3f480e0962fd33f"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">实验结果</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/bd386682390145938735952b6d22bd82"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">一些容易忽略的点</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/7dd51311fcdb49ae8a17ec41c1d868b2"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">总结</span></span></div></a></li></ul><h1 id="https://www.notion.so/9f8a2e02178c462b937369990d5e6dd5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/9f8a2e02178c462b937369990d5e6dd5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">简介</span></span></h1><blockquote id="https://www.notion.so/ab1a038c29214b68b8a7f40a626b169c" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">本文只是学习笔记，文中不会公布代码，只是记录自己的实现思路，如果不符合约定或规范，请联系我删除。</span></span></blockquote><div id="https://www.notion.so/ef0484588ba84a4abfd5fee2b925ebfd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">本次lab 对应到 week 3。</span></span></p></div><div id="https://www.notion.so/875bae65e83447308e2a3d460af4f220" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fac558c1f-e369-4f07-bfb1-37f60ed4474f%2FUntitled.png?width=1630&amp;table=block&amp;id=875bae65-e834-4730-8e2a-3d460af4f220"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fac558c1f-e369-4f07-bfb1-37f60ed4474f%2FUntitled.png?width=1630&amp;table=block&amp;id=875bae65-e834-4730-8e2a-3d460af4f220" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/8fd4aa8bfd24410bb8d8d757b870f69a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">week 3 的 slide 讲的都是包交换（packet switching）技术，这里记录一下基本概念：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/2ec89adc3bc24a3d8814a78952926130" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">包交换技术</span></span></li></ul><div id="https://www.notion.so/928bad78e14a4d34ac78a16bbd05d959" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">数据从http ⇒ tcp ⇒ ip层层封装然后</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">交给路由器转发到目的地</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/5b29bb3b80884c1eb53d7c9a5a1faa6c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Delay</span></span><div id="https://www.notion.so/55b509a835bc4bc4a3495be4b7daef7e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">使用路由交换技术不可避免的延迟：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/74afc34a8b214c04a4370a9c44d1684b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">链接上固定的传播延迟。 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Propagation delay along the links (fixed)</strong></span></span></li><li id="https://www.notion.so/c325380c29df4850b11d184d15dc6e2b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">数据打包的固定延迟。</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Packetization delay to place packets onto links (fixed</strong></span><span class="SemanticString">)</span></span></li><li id="https://www.notion.so/130bcec465394d039dbe067b2caa64ca" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">路由器数据包缓冲区中的排队延迟. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Queueing delay in the packet buffers of the routers (variable)</strong></span></span></li></ul></li><li id="https://www.notion.so/1960cd28a23a4a5bbd07513f3c0739a0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">缓冲区</span></span></li></ul><div id="https://www.notion.so/9bc1ea4d8be1431f946a0f7348d1d786" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">网络环境是有波动的，如下图：</span></span></p></div><div id="https://www.notion.so/341d3038d3e14160820274fdb54ce166" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7fa5a5a6-678f-44dd-9479-9e0ebfbd4a24%2FUntitled.png?width=720&amp;table=block&amp;id=341d3038-d3e1-4160-8202-74fdb54ce166"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7fa5a5a6-678f-44dd-9479-9e0ebfbd4a24%2FUntitled.png?width=720&amp;table=block&amp;id=341d3038-d3e1-4160-8202-74fdb54ce166" style="width:720px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/3d7ec1da735b4b0397474f4400cc9a71" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">发送的bytes和时间的曲线可能会产生波动，为此缓冲区可以缓解这些波动带来的影响。缓冲区可以将部分数据缓存起来，避免丢失。</span></span></p></div><div id="https://www.notion.so/3784bea087aa4ed6ad7da5606e1e7875" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这次lab的任务是完成StreamReassembler部分</span></span></p></div><div id="https://www.notion.so/74dead5634ae4bbfa7df838792afa31a" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8d435ace-5442-4752-b834-e47d9a0b604e%2FUntitled.png?width=1858&amp;table=block&amp;id=74dead56-34ae-4bbf-a7df-838792afa31a"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8d435ace-5442-4752-b834-e47d9a0b604e%2FUntitled.png?width=1858&amp;table=block&amp;id=74dead56-34ae-4bbf-a7df-838792afa31a" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/eb9712d0ee994009b6c5797dee36b312" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">同时说明了我们每个 lab 需要做的任务</span></span></p></div><div id="https://www.notion.so/b158acf2f7734feb8e5a1f9108e88e2e" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F422080c5-585d-48cf-8b70-127895829c42%2FUntitled.png?width=2008&amp;table=block&amp;id=b158acf2-f773-4feb-8e5a-1f9108e88e2e"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F422080c5-585d-48cf-8b70-127895829c42%2FUntitled.png?width=2008&amp;table=block&amp;id=b158acf2-f773-4feb-8e5a-1f9108e88e2e" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h1 id="https://www.notion.so/863effd6d71e4a769b69341a175799b6" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/863effd6d71e4a769b69341a175799b6"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">2 Getting started</strong></span></span></h1><div id="https://www.notion.so/4ceef53122c346a8bb6965d4919f29f1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这边要求我们合并远程的 lab1-startercode 代码再继续工作。</span></span></p></div><div id="https://www.notion.so/fe2e25ddb23a410a8fa250ddf8f46e43" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我一开始没搞清楚这个 lab 的 git 分支逻辑，然后尝试了几次才搞清楚。</span></span></p></div><div id="https://www.notion.so/535a751373374646bdc21663a41f4145" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这个 lab 的每一个分支都对应一个lab</span></span></p></div><div id="https://www.notion.so/fa0892f53c7b47a49066d356f3935e59" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Feb189974-c31e-49f5-9ce6-5af20c957f94%2FUntitled.png?width=288&amp;table=block&amp;id=fa0892f5-3c7b-47a4-9066-d356f3935e59"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Feb189974-c31e-49f5-9ce6-5af20c957f94%2FUntitled.png?width=288&amp;table=block&amp;id=fa0892f5-3c7b-47a4-9066-d356f3935e59" style="width:288px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/b36bfbe7a49b4a008ada32ee6a960e26" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们每完成一个分支，都要保存下来，然后在完成的工作基础上合并新的</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">labx-startercode</code></span><span class="SemanticString"> 进行开发。</span></span></p></div><div id="https://www.notion.so/a9ca6c02ade14793bc2b2507d4b1c248" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">比如说我自己的仓库有 master，我开了一个 lab0 的分支，然后完成了 lab0 的测试。</span></span></p></div><div id="https://www.notion.so/c5144f1d8fda43fd8be9d6f4cafaa500" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">接着我从 lab0 checkout 出来一个 lab1 的分支，然后 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">merge lab1-startercode</code></span><span class="SemanticString"> 到这个新的 lab1 分支上，完成 lab1 的任务，以此类推</span></span></p></div><div id="https://www.notion.so/a405946ba7374da88ca17965c265c01e" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F675be5d9-92da-4959-b754-2a510f6dc36f%2FUntitled.png?width=1834&amp;table=block&amp;id=a405946b-a737-4da8-8ca1-7965c265c01e"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F675be5d9-92da-4959-b754-2a510f6dc36f%2FUntitled.png?width=1834&amp;table=block&amp;id=a405946b-a737-4da8-8ca1-7965c265c01e" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/c17588c0e5c24a5682c3e027790b3caa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">示意图大概就是这样</span></span></p></div><div id="https://www.notion.so/1f44fb9cbbcc4cf2938aeb40d9d2df35" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当然这是我自己的 git 风格，你可以在原始的 master 上进行迭代开发，而我习惯每进行一个 lab 都创建一个新的分支</span></span></p></div><div id="https://www.notion.so/ed1dd4bd02504cb7aa47609842112da1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ok，搞定之后我们看需求</span></span></p></div><h1 id="https://www.notion.so/ba42584f24514f81b47d637cf8b2fbfd" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/ba42584f24514f81b47d637cf8b2fbfd"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">3 Putting substrings in sequence</span></span></h1><div id="https://www.notion.so/6d0befb8e7ab4396ad690d2f1d7d3d31" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在 lab1 和 lab2 我们将要实现 TCP receiver，它能够接受数据报文并且将它们转换为可靠的字节流供应用程序从 socket 中读取数据。</span></span></p></div><div id="https://www.notion.so/867e0054eb544d25823fe22a34e406ee" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">TCP sender 将字节流分割为多个 segments，每个子串最大长度不超过 1460 bytes。网络是不稳定的，可能会产生乱序、丢失、重复提交等这些工作。receiver 必须要充足这些 segments 以实现可靠的字节流（reliable byte stream）</span></span></p></div><div id="https://www.notion.so/f5efa049f07e461d9bd43c8b76745007" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">本次 lab 的工作就是实现 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">StreamReassmbler</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/7f7137b54b3b4933a34de766bc15d10a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">接收 substrings，包括了组成 string 的 bytes，还有 string 在 stream 中 的唯一 index。这些数据可能是乱序的，需要我们组装起来</span></span></li><li id="https://www.notion.so/bde5a5f7267e4207937bfc65cf0b8224" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">使用 ByteStream 作为输出，有序的把 bytes 写入到 ByteStream 中</span></span></li></ul><div id="https://www.notion.so/613d5d2469354b878c1fe6dc446fe42f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">然后文档也给出了需要实现的接口，同时强调了 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">StreamReassmbler </strong></span><span class="SemanticString">实现的是 TCP 的可靠性：从任意字节数据中恢复出原有的数据流，用此来对抗网络波动产生的丢失、复制等结果。</span></span></p></div><div id="https://www.notion.so/0e613d2f63724674b4ce034eab03c187" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">接口说明在</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">stream_reassembler.hh</code></span><span class="SemanticString"> </span></span></p></div><h2 id="https://www.notion.so/4cfdcc8725b14a77a223d18dbe2b2f03" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/4cfdcc8725b14a77a223d18dbe2b2f03"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">3.1 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">What’s the “capacity”?</strong></span></span></h2><div id="https://www.notion.so/47df538c4e1e44c2826121bc79289723" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">主要是定义了 capacity 的含义：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/d3c7eef813804f66976be7196540867a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">一方面是限制了 ByteStream 的大小</span></span></li><li id="https://www.notion.so/e66721f5576d47c295172fb51c86e849" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">另一方面限制了从 substrings 中读取的最大 bytes 数</span></span></li></ul><div id="https://www.notion.so/13c4927c32a24d3bb3bd28bcc5d4bf9e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">比如下面这种图</span></span></p></div><div id="https://www.notion.so/1308b9f8e0804363889afdf9dcf614f3" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F5643bc4a-1688-4992-94d3-b92d373525f2%2FUntitled.png?width=1750&amp;table=block&amp;id=1308b9f8-e080-4363-889a-fdf9dcf614f3"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F5643bc4a-1688-4992-94d3-b92d373525f2%2FUntitled.png?width=1750&amp;table=block&amp;id=1308b9f8-e080-4363-889a-fdf9dcf614f3" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/0d5888b28bf541f592437ae16aab6437" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">蓝色部分指的是已经处理完的数据，绿色部分指的是在 ByteStream 中的数据，红色部分指的是还没有放入 ByteStream 的部分，后面的部分就是还没开始处理的数据</span></span></p></div><div id="https://www.notion.so/ee91cec9b9dd43fba660710dafa3207a" class="Divider"></div><h1 id="https://www.notion.so/93408011d4cc489c882ba855035f253a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/93408011d4cc489c882ba855035f253a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">分析和设计</span></span></h1><div id="https://www.notion.so/6f253520b23546c4b8f487d228760715" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们最终要设计的结构如下所示：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/b6e2f92281f840f49c4099aa76d4d6f3" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">有一个 buffer 帮助我们缓存不能立即放入 ByteStream 的数据</span></span></li><li id="https://www.notion.so/b046f796de30420bbd9c26cd3c581bda" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">一个 ByteStream 供读写</span></span></li></ul><div id="https://www.notion.so/e80cc552bae74a0184438c3719d0b340" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4ec99f2d-fb4c-40dc-805b-e197e07ea7e3%2FUntitled.png?width=1706&amp;table=block&amp;id=e80cc552-bae7-4a01-8443-8c3719d0b340"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4ec99f2d-fb4c-40dc-805b-e197e07ea7e3%2FUntitled.png?width=1706&amp;table=block&amp;id=e80cc552-bae7-4a01-8443-8c3719d0b340" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/e367d9d555794d57a85c8ca8e90a75e3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">特别的我们需要注意这种情况：</span></span></p></div><div id="https://www.notion.so/5aff3e5949b746bc807cb45908acc07c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa97bdd9a-18fe-4972-b13a-7d11344caa68%2FUntitled.png?width=1030&amp;table=block&amp;id=5aff3e59-49b7-46bc-807c-b45908acc07c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa97bdd9a-18fe-4972-b13a-7d11344caa68%2FUntitled.png?width=1030&amp;table=block&amp;id=5aff3e59-49b7-46bc-807c-b45908acc07c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/cedfe4b499984dc180d41e05453870bd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">假设我们读入 5 和 6，那么后面的三个 bytes 也应该一并放入 ByteStream 中</span></span></p></div><div id="https://www.notion.so/33233b383d49436cb09cadee2a03cab4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">然后我们需要合并 buffer 中的 bytes，例如：</span></span></p></div><div id="https://www.notion.so/c0c55b8e8c21485aae7040fbdd208ded" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6e46f64a-9189-45f0-9d23-a3e076a7853d%2FUntitled.png?width=654&amp;table=block&amp;id=c0c55b8e-8c21-485a-ae70-40fbdd208ded"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6e46f64a-9189-45f0-9d23-a3e076a7853d%2FUntitled.png?width=654&amp;table=block&amp;id=c0c55b8e-8c21-485a-ae70-40fbdd208ded" style="width:654px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/07759df81d9249b688ba072f20d59902" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">如果某次输入中带有10、11，例如 index = 7，data = “aaaa”，那么 7 ~ 12 的数据应该立即合并 </span></span></p></div><h1 id="https://www.notion.so/0d180ebc6c1e401ab3f480e0962fd33f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/0d180ebc6c1e401ab3f480e0962fd33f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">实验结果</span></span></h1><div id="https://www.notion.so/8667914c2f884d41bbbcd928c3e960cf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">第一次尝试</strong></span></span></p></div><div id="https://www.notion.so/95dbb9a4bfce4dd282a7afe060ea2721" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">第一个版本，用 set 来标记出现过的 index，用 map 来作为缓冲区，每次</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">push_substring</code></span><span class="SemanticString">的时候都先往 map 里面放，然后再尝试从 map 里面取 byte 放到 ByteStream 里面</span></span></p></div><div id="https://www.notion.so/317cd0d7fa744c9ab310e3a35446cc7a" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fab6ed6db-ff2c-456a-b4a5-6d5b4e88a893%2FUntitled.png?width=1306&amp;table=block&amp;id=317cd0d7-fa74-4c9a-b310-e3a35446cc7a"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fab6ed6db-ff2c-456a-b4a5-6d5b4e88a893%2FUntitled.png?width=1306&amp;table=block&amp;id=317cd0d7-fa74-4c9a-b310-e3a35446cc7a" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/92dd1260d062462ab3ed1e68b6c14d3b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">虽然通过了本地测试，但是性能比较糟糕。</span></span></p></div><div id="https://www.notion.so/c055d9f4dcfb4f57bebda1160e389af8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">首先是按照 byte 插入 buffer 性能太低了，然后用 set 标记使用过的 index 是没有必要的，因为最终表示的字节流是一致的，我当时写的时候没有注意到这一点</span></span></p></div><div id="https://www.notion.so/3d23e0f7bc17407e9f2b230787142572" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">第二次尝试</strong></span></span></p></div><div id="https://www.notion.so/f4c05ed8ec2c44aa819edd3de8191044" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">经过第一次尝试，现在问题清晰很多了，问题本质就是一个算法问题：</span></span></p></div><div id="https://www.notion.so/090c678c5c714820b6be59242c67e295" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">对于一大段的 bytes，有多个切片（线段），切片之间可能重叠，每次输入会提供一个切片和起点，对于能够立即写入的切片，应该马上写入到 ByteStream 中，不能写入的切片应该暂存，但是需要丢弃容量之外的 bytes。</span></span></p></div><div id="https://www.notion.so/6e2e2a3602ef4748acf1d0e5b68dc5ad" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">显然我们从线段的角度考虑更优，这里的线段可能会重叠、乱序、重复，但是它们表示的 bytes 都是</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">一致</strong></span><span class="SemanticString">的，这个性质很重要。</span></span></p></div><div id="https://www.notion.so/818aee895d484bbabb502678c6c27bda" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">对于这个角度，我最先想到用堆来处理，每次都把一个 node: &lt;index, slice&gt; 放置到堆中，然后尝试将堆顶写入到 ByteSteam 中。但是用堆经过若干次插入后可能会变得很冗余，也就是线段重叠的部分会很多，这是不符合设计的（lab1 的 FAQs 也有说明）。</span></span></p></div><div id="https://www.notion.so/166526013aa3496e828995bd4356f7eb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">于是可以在堆上进一步尝试，我们根据 node 的 index 作为第一索引，存放到一个有序的数据结构中，我们对这个数据结构的要求是：node 之间没有重叠的部分。</span></span></p></div><div id="https://www.notion.so/02c608a522e846ffa694dec2791e0b85" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">那么在 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">push_substring</code></span><span class="SemanticString"> 的时候，对于当前的 node，我们可以检查它前后的 node 是否能合并，如果能合并则消除重叠部分，直到不能合并为止。这样能够保证数据结构中的 node 都是无重叠的。显然用二叉排序树能够很好的满足我们的要求，还可以用二分来加快查找过程。在 cpp 里面，set 的底层是红黑树，使用起来很方便。</span></span></p></div><div id="https://www.notion.so/054a6defbbce4f2796b04249f1a50be7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这个核心数据结构想明白之后，接下来的实现就简单了。</span></span></p></div><div id="https://www.notion.so/3d7ec3adabac457687176556fa5560b1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">push_substring</code></span><span class="SemanticString">的流程</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/e8cdbe23814442e9bdd435de85755430" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">检查是否越界</strong></span></span><div id="https://www.notion.so/848dd72b71fd471e8812e841a9d17057" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F639b4d70-a38c-4ecd-ba99-a4054f794689%2FUntitled.png?width=432&amp;table=block&amp;id=848dd72b-71fd-471e-8812-e841a9d17057"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F639b4d70-a38c-4ecd-ba99-a4054f794689%2FUntitled.png?width=432&amp;table=block&amp;id=848dd72b-71fd-471e-8812-e841a9d17057" style="width:432px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/15dbf51538a745b7aa9cd6a15f341db5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">假设 recv_index_ 是期望接收的第一个 index，而 last_store_index_ 是最后不能接收的字符（index = 0，cap = 8 时，last_store_index_ = 8）</span></span></p></div><div id="https://www.notion.so/8114b4a205e34ac7bf3737e898d39c20" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">那么从图中来看，我们需要丢弃 1 和 5 两种情况</span></span></p></div></li><li id="https://www.notion.so/81cc075d47984b6ca292f093f56665a5" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">裁剪线段</strong></span></span><div id="https://www.notion.so/d233caf289bc477da647ead99d98fa5c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">根据上图，2 和 4 都需要裁剪出处于区间的部分，3不用裁剪</span></span></p></div><div id="https://www.notion.so/d78eebd820b542de90308f4440ccbb1c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">特别的，4 需要我们进行 eof 的判断，如果 4 是 eof 的，那么此时这个 eof 指令是无效的，因为最后的字符被裁剪掉了</span></span></p></div><div id="https://www.notion.so/77551899a74943f7a4a020b8c3cfb10a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">另外我们还需要考虑一种完全覆盖区间的情况，即 2 + 3 + 4，这中情况即需要裁剪头部，也需要裁剪尾部，因此我们不能用</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"> if … else … </code></span><span class="SemanticString"> 进行处理</span></span></p></div></li><li id="https://www.notion.so/a44e87d63bb44c3f9bfb688e5a5294c2" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">在树中合并</strong></span></span><div id="https://www.notion.so/cbda393768a74319aacef703adeac1b1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">由于最终指向的 bytes 是</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">一致</strong></span><span class="SemanticString">的，我们处理起来的难度大大降低了</span></span></p></div><div id="https://www.notion.so/d0c30f1b7f4b48b597bfae2e299c17cb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">现在我们得到了经过裁剪后的 node，我们想要把它插入到树中，保持树中 node 无重叠的性质，那么就需要我们对树的 node 进行合并。</span></span></p></div><div id="https://www.notion.so/67878683b0b34be3bc003a309d8d4ab0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">先是</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">向后合并</span></span></span></p></div><div id="https://www.notion.so/3062c28a76c145a89fa09f8cc7254003" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们根据lower_bound，找到结构中对应的下一个 node，判断两个 node 的位置关系</span></span></p></div><div id="https://www.notion.so/0a258336611542d69340e70f547569ae" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6b0dd19f-81ef-4fa3-b574-405d29cfada9%2FUntitled.png?width=1018&amp;table=block&amp;id=0a258336-6115-42d6-9340-e70f547569ae"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6b0dd19f-81ef-4fa3-b574-405d29cfada9%2FUntitled.png?width=1018&amp;table=block&amp;id=0a258336-6115-42d6-9340-e70f547569ae" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/dd98b8a621544da9ba6140219ded4608" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">由上图我们可以总结出三种类型的位置关系，分别是重叠、不重叠、覆盖</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/64f603433f8f44cdbde304f6fe5bfffc" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">case 1，如果不重叠，退出向后合并</span></span></li><li id="https://www.notion.so/edef149b8bf047b6b3452fbb3e0afce8" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">case 3，如果覆盖，把被覆盖的线段移除，因为当前线段能够表示被覆盖的线段了，继续向后合并</span></span></li><li id="https://www.notion.so/cd052b9862f34ed38df9b851494d9374" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">case 2，如果重叠，那么合并两条线段，移除下一条线段，继续向后合并</span></span></li></ol><div id="https://www.notion.so/ef657d0779c744f98cbdcf2a7c54245c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">向后合并完毕后，考虑</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">向前合并</span></span></span></p></div><div id="https://www.notion.so/6bbea3470f9f48f490d2132d69b09175" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff4ac74d5-f942-4cde-bf40-b3d3123e68ca%2FUntitled.png?width=880&amp;table=block&amp;id=6bbea347-0f9f-48f4-90d2-132d69b09175"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff4ac74d5-f942-4cde-bf40-b3d3123e68ca%2FUntitled.png?width=880&amp;table=block&amp;id=6bbea347-0f9f-48f4-90d2-132d69b09175" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/9c84329860a243d592c1a495933cd034" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">情况也是一样的</span></span></p></div><div id="https://www.notion.so/9a8967e63b8c4325a2dfd91081b57c8e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">那么经过最终的前后合并，树中的 node 都是无重叠的了</span></span></p></div><div id="https://www.notion.so/0783a1f893814391b42281e6b4ef8a82" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa706dbbe-5a9f-48e6-b167-e491d890c16a%2FUntitled.png?width=1070&amp;table=block&amp;id=0783a1f8-9381-4391-b422-81e6b4ef8a82"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa706dbbe-5a9f-48e6-b167-e491d890c16a%2FUntitled.png?width=1070&amp;table=block&amp;id=0783a1f8-9381-4391-b422-81e6b4ef8a82" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></li><li id="https://www.notion.so/85d88bfdc2a94bf0b5f8d74a256040cc" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">尝试写入 ByteStream</span></span><div id="https://www.notion.so/d8f01a17eca24a7ba073f137f4502322" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当我们树中第一个 node 的 index，恰好等于 recv_index_ 的时候，就能进行写入了</span></span></p></div></li><li id="https://www.notion.so/7f7adcd66b9b483d93b94d50d71b22b3" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">eof 的处理</span></span><div id="https://www.notion.so/4481f04f067d490b899a1a0bb6ef7dd1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们先考虑一下 eof 什么时候是有效的，当且仅当 eof = true 且 最后一个字符被读入的时候就是有效的。那么回到最原始的这张图</span></span></p></div></li></ol><div id="https://www.notion.so/8f60143ffecd438f89b9799bd4c63d8b" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F639b4d70-a38c-4ecd-ba99-a4054f794689%2FUntitled.png?width=432&amp;table=block&amp;id=8f60143f-fecd-438f-89b9-799bd4c63d8b"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F639b4d70-a38c-4ecd-ba99-a4054f794689%2FUntitled.png?width=432&amp;table=block&amp;id=8f60143f-fecd-438f-89b9-799bd4c63d8b" style="width:432px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/f88c3c9ba5dc4f0586616914e53f6a46" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">对于 2 和 3，它们的 eof 都是有效的，对于 4 和 5，它们的 eof 都是无效的，因为最后一个字符被丢弃了，而对于 1 呢，测试用例并没有体现，我也把它视为无效的情况了。</span></span></p></div><div id="https://www.notion.so/b2cb5a3576114eb9aa031176194c8476" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">最终通过了测试，满足了 lab 1 的 0.5 s 性能需求</span></span></p></div><div id="https://www.notion.so/e10627b7c6834779810a452de9f1ef77" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb1826731-6b64-4784-86e5-7a93f69aeb16%2FUntitled.png?width=1316&amp;table=block&amp;id=e10627b7-c683-4779-810a-452de9f1ef77"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb1826731-6b64-4784-86e5-7a93f69aeb16%2FUntitled.png?width=1316&amp;table=block&amp;id=e10627b7-c683-4779-810a-452de9f1ef77" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h1 id="https://www.notion.so/bd386682390145938735952b6d22bd82" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/bd386682390145938735952b6d22bd82"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">一些容易忽略的点</span></span></h1><div id="https://www.notion.so/50dd50bce17b4009bd60c6f92747cd23" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">一定要认真看 3.2 FAQs</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/7cb71674951c49bd8ac6b59842137011" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">切片表示的最终的 bytes 是一致的</span></span></li></ul><div id="https://www.notion.so/8679182721724388909beaf5b41f08c4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在 3.2 FAQs 中提到了</span></span></p></div><div id="https://www.notion.so/e45970b133e048328dd38ea8899107d9" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbe83fba7-6f5f-4c8e-aca9-40a2026b4797%2FUntitled.png?width=1672&amp;table=block&amp;id=e45970b1-33e0-4832-8dd3-8ea8899107d9"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbe83fba7-6f5f-4c8e-aca9-40a2026b4797%2FUntitled.png?width=1672&amp;table=block&amp;id=e45970b1-33e0-4832-8dd3-8ea8899107d9" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/f5013776fc8c4a88a9dfa1b161843e77" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">buffer 中的最好不要存储重叠的子串</span></span></li></ul><div id="https://www.notion.so/7171e9bbf99e4e5295fc922ce1ba6e11" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9facd4b5-4ace-48d0-9a97-b6b6b5c3c9f6%2FUntitled.png?width=1672&amp;table=block&amp;id=7171e9bb-f99e-4e52-95fc-922ce1ba6e11"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9facd4b5-4ace-48d0-9a97-b6b6b5c3c9f6%2FUntitled.png?width=1672&amp;table=block&amp;id=7171e9bb-f99e-4e52-95fc-922ce1ba6e11" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/7a8603d20a744d9788c13cf49c2a0243" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">注意计算 first unassembled 和 first unacceptable</span></span></li></ul><div id="https://www.notion.so/89a0ae3e95ea460bb81696689754391c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F3d02df14-3489-43e6-99d4-ac75f4f08f14%2FUntitled.png?width=1726&amp;table=block&amp;id=89a0ae3e-95ea-460b-b816-96689754391c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F3d02df14-3489-43e6-99d4-ac75f4f08f14%2FUntitled.png?width=1726&amp;table=block&amp;id=89a0ae3e-95ea-460b-b816-96689754391c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/736b219dcc734ca99958df511e7720a8" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">有些不确定的地方，看测试用例确定应该怎么处理</span></span></li></ul><div id="https://www.notion.so/0c4aea65f6c24d988daeb5c7b7bdd861" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">如果还不能确定，就自己约定一个一致的风格好了</span></span></p></div><h1 id="https://www.notion.so/7dd51311fcdb49ae8a17ec41c1d868b2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/7dd51311fcdb49ae8a17ec41c1d868b2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">总结</span></span></h1><div id="https://www.notion.so/7337466dff5b4becb7e6f7d0b11a8520" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">其实这个 lab1 总结出来后就是一个算法问题了，比较考验学生的算法能力。</span></span></p></div><div id="https://www.notion.so/795cc87944aa401dafbdf9da5108ff67" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">整个</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">StreamReassembler</code></span><span class="SemanticString">实现的功能更能很像上计网课的时候讲到的滑动窗口，没想到是这种数据结构实现的。</span></span></p></div><div id="https://www.notion.so/02d6ac69e466494191c6a3e25ca39016" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">debug</strong></span></span></p></div><div id="https://www.notion.so/9b080ce662b14c70aa2774acaa99f240" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">coding 途中我遇到了不稳定复现的 bug，而且由于没有好用的调试工具（或者说自己暂时没学会如何更好地调试 cpp），导致 debug 非常困难
不过好在最终成功 debug 了，下面是我的一些心得：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/f79d5302afff40d2a6d323cea06749a5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">计算机不会骗人，不要怀着“我的代码没问题啊”这种心态去 debug，不然自己很容易崩溃</span></span></li><li id="https://www.notion.so/9b5a282d5717463e8faf2bc328f809f3" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">高效的 debug 工具非常重要，能帮你节省很多时间</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/8dd701fec6074770840bba389091b7a7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">尽量让自己的工作自动化，能够节省很多时间</span></span></li></ul></li><li id="https://www.notion.so/0752531d733749cfb09a9f6fc88d16e7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">想办法弄到导致 bug 的数据，如果没办法弄到，观察日志分析走到哪一步导致不符合预期的结果，然后根据调用链跟进</span></span></li></ul><div id="https://www.notion.so/87ec4c5489bb4429834e4ccf6e830bd7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></article>
  <footer class="Footer">
  <div>&copy; Notablog 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>